@model IEnumerable<Model.View.Meeting2>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var roomName = (string)ViewBag.roomName;
}
@section jsFooter
{
<script src="/Assets/theme3/plugins/fullcalendar/fullcalendar.min.js"></script>
<!-- Page specific script -->
<script>
    $(function () {

        /* initialize the external events
         -----------------------------------------------------------------*/
        function ini_events(ele) {
            ele.each(function () {

                // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
                // it doesn't need to have a start or end
                var eventObject = {
                    title: $.trim($(this).text()) // use the element's text as the event title
                }

                // store the Event Object in the DOM element so we can get to it later
                $(this).data('eventObject', eventObject)

                // make the event draggable using jQuery UI
                $(this).draggable({
                    zIndex: 1070,
                    revert: true, // will cause the event to go back to its
                    revertDuration: 0  //  original position after the drag
                })

            })
        }

        ini_events($('#external-events div.external-event'))

        /* initialize the calendar
         -----------------------------------------------------------------*/
        //Date for the calendar events (dummy data)
        var date = new Date()
        var d = date.getDate(),
            m = date.getMonth(),
            y = date.getFullYear()
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            buttonText: {
                today: 'hôm nay',
                month: 'month',
                week: 'week',
                day: 'day'
            },
            //Random default events

            events: [
                @foreach(var item in Model)
                {
                    
                   <text>
                     {
                         title: '@item.Reason',
                         start: new Date( @item.TimeFrom.Year,@item.TimeFrom.Month-1,@item.TimeFrom.Day,@item.TimeFrom.Hour,@item.TimeFrom.Minute),
                         end: new Date( @item.TimeTo.Year,@item.TimeTo.Month-1,@item.TimeTo.Day,@item.TimeTo.Hour,@item.TimeTo.Minute),
                         url: '/Meeting/Edit/@item.ID',
                         backgroundColor: '#3c8dbc',
                         borderColor: '#3c8dbc'
                     },
                   </text>
                }


            ],

            editable: true,
            droppable: true, // this allows things to be dropped onto the calendar !!!
            drop: function (date, allDay) { // this function is called when something is dropped

                // retrieve the dropped element's stored Event Object
                var originalEventObject = $(this).data('eventObject')

                // we need to copy it, so that multiple events don't have a reference to the same object
                var copiedEventObject = $.extend({}, originalEventObject)

                // assign it the date that was reported
                copiedEventObject.start = date
                copiedEventObject.allDay = allDay
                copiedEventObject.backgroundColor = $(this).css('background-color')
                copiedEventObject.borderColor = $(this).css('border-color')

                // render the event on the calendar
                // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                $('#calendar').fullCalendar('renderEvent', copiedEventObject, true)

                // is the "remove after drop" checkbox checked?
                if ($('#drop-remove').is(':checked')) {
                    // if so, remove the element from the "Draggable Events" list
                    $(this).remove()
                }

            }
        })

        /* ADDING EVENTS */
        var currColor = '#3c8dbc' //Red by default
        //Color chooser button
        var colorChooser = $('#color-chooser-btn')
        $('#color-chooser > li > a').click(function (e) {
            e.preventDefault()
            //Save color
            currColor = $(this).css('color')
            //Add color effect to button
            $('#add-new-event').css({
                'background-color': currColor,
                'border-color': currColor
            })
        })
        $('#add-new-event').click(function (e) {
            e.preventDefault()
            //Get value and make sure it is not null
            var val = $('#new-event').val()
            if (val.length == 0) {
                return
            }

            //Create events
            var event = $('<div />')
            event.css({
                'background-color': currColor,
                'border-color': currColor,
                'color': '#fff'
            }).addClass('external-event')
            event.html(val)
            $('#external-events').prepend(event)

            //Add draggable funtionality
            ini_events(event)

            //Remove event from text input
            $('#new-event').val('')
        })
    })
</script>
    }
<link rel="stylesheet" href="/Assets/theme3/plugins/fullcalendar/fullcalendar.min.css">
<link rel="stylesheet" href="/Assets/theme3/plugins/fullcalendar/fullcalendar.print.css" media="print">
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Chọn Phòng Họp</h4>
            </div>
            <div class="card-body">
                <!-- the events -->
                <div id="row">
                    <a href='~/Meeting/MeetingRoom/1'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-success">Phòng 1 X1(tầng trệt)</div></a>
                    <a href='~/Meeting/MeetingRoom/2'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-warning">Phòng 2 X1(tầng trệt)</div></a>
                    <a href='~/Meeting/MeetingRoom/6'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-info">Phòng 3 X1 (mới-tầng trệt)</div></a>
                    <a href='~/Meeting/MeetingRoom/5'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-primary">Phòng 4 X1 (lầu 2)</div></a>
                    <a href='~/Meeting/MeetingRoom/0'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-danger-gradient">Phòng họp ONLINE</div></a>

                    @*<a href='~/Meeting/MeetingRoom/4'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-primary">Phòng Họp Xưởng 2</div></a>
                    <a href='~/Meeting/MeetingRoom/3'><div style=" height: 50px;padding: 12px;font-weight: bold; margin-top: 10px;" class="bg-danger">Phòng Họp Xưởng 3</div></a>*@              
                     
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <!-- the events -->
                <div id="row">
                    <a href="/Meeting/Create">
                        <span class="mailbox-attachment-icon has-img"><img src="~/Assets/theme3/dist/img/phonghop.jpg" alt="Attachment"></span>
                        <div class="mailbox-attachment-info" style="background:#fff">
                            <span class="mailbox-attachment-name"><i class="fa fa-plus" style="color:red"></i> Đặt lịch phòng họp</span>
                        </div>
                    </a>

                </div>
            </div>
        </div>
    </div>
    <!-- /.col -->
    <div class="col-md-9">
        <div class="card card-primary">
            <div class="card-body p-0">
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>