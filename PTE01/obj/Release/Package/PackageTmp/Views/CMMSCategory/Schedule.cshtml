@model List<Model.EF.CMMSPlanChart>

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var category = (List<Model.EF.CMMSPlan2>)ViewBag.category;
    var Type = new List<SelectListItem>();
    Type.Add(new SelectListItem
    {
        Text = "Tất cả",
        Value = "-1",
        Selected = true
    });
    Type.Add(new SelectListItem
    {
        Text = "Chưa bảo trì",
        Value = "0",
    });
    Type.Add(new SelectListItem
    {
        Text = "Đã bảo trì",
        Value = "1",
    });
    Type.Add(new SelectListItem
    {
        Text = "Bỏ lỡ bảo trì",
        Value = "2",
    });
}

@section jsFooter
{
    <script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
    <script>
        $(function () {
            $('.form_datetime').datepicker({
                format: 'mm/dd/yyyy',
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
            });

        })
    </script>

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Scripts/GranttChart/jsgantt.css" rel="stylesheet" />
<script src="~/Scripts/GranttChart/jsgantt.js"></script>
<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Kế hoạch bảo trì</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <label class="control-label">Thiết bị</label><br>
                <select class="form-control select2" id="device" name="device">
                    <option value="0" selected>Chọn thiết bị</option>
                    @foreach (var item in category)
                    {
                        <option value="@item.ID">@item.Name</option>
                    }

                </select>
            </div>
            <div class="col-md-2">
                <label class="control-label">Loại</label><br>
                <select class="form-control select2" id="type" name="type">
                    @foreach (var item in Type)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }

                </select>
            </div>
            <div class="col-md-2">
                <label class="control-label">Thời gian Từ:</label>
                <div class="bootstrap-timepicker">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="start" name="start" class="form-control form_datetime" readonly="readonly" value='@if(ViewBag.start!=null){@ViewBag.start}else{@DateTime.Now.ToShortDateString()}'><br>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-2">
                <label class="control-label">Đến:</label>
                <div class="bootstrap-timepicker">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="end" name="end" class="form-control form_datetime" readonly="readonly" value='@if(ViewBag.end!=null){@ViewBag.end}else{@DateTime.Now.AddDays(7).ToShortDateString()}'><br>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <label class="control-label"></label>
                <div class="form-group">
                    <a class="btn btn-primary" id="inbaocao">Tìm kiếm</a>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function () {

                $("#inbaocao").click(function () {
                    var lines = $("#device").val();
                    var start = $('#start').val();
                    var end = $('#end').val();
                    var type = $('#type').val();
                    $('#inbaocao').attr("href", '/CMMSCategory/Schedule?device=' + lines + '&start=' + start + '&end=' + end + '&type=' + type);

                });

            });

        </script>
    </div>
</div>
<div class="row">
    <div style="position:relative" class="gantt" id="GanttChartDIV"></div>
    <script>
        var g = new JSGantt.GanttChart('g', document.getElementById('GanttChartDIV'), 'day');
        g.setShowRes(1); // Show/Hide Responsible (0/1)
        g.setShowDur(0); // Show/Hide Duration (0/1)
        g.setShowComp(0); // Show/Hide % Complete(0/1)
        g.setCaptionType('Resource');  // Set to Show Caption
        if (g) {
            @foreach (var item in Model)
            {
                if (item.Status == 0 )
                {
                    if (item.EndDate > DateTime.Today)
                    {
                    <text>
            g.AddTaskItem(new JSGantt.TaskItem('@item.ID', '@item.NameDevice: @item.Name', '@item.StartDate.Value.AddDays(-7)', '@item.EndDate', '007CFF', '/CMMSCategory/UpdateSchedule/@item.ID', 0, '@item.CreateBy', 50, 0, 1, 1));
                    </text>}
                    else
                    {
                    <text>
            g.AddTaskItem(new JSGantt.TaskItem('@item.ID', '@item.NameDevice: @item.Name', '@item.StartDate.Value.AddDays(-7)', '@item.EndDate', 'FFF300', '/CMMSCategory/UpdateSchedule/@item.ID', 0, '@item.CreateBy', 50, 0, 1, 1));
                    </text>
                    }
                }
                else if(item.Status == 1)
                {
                    if (item.PerformDate >= item.EndDate)
                    {
                    <text>
            g.AddTaskItem(new JSGantt.TaskItem('@item.ID', '@item.NameDevice: @item.Name', '@item.StartDate.Value.AddDays(-7)', '@item.EndDate', 'FFF300', '/CMMSCategory/UpdateSchedule/@item.ID', 0, '@item.CreateBy', 50, 0, 1, 1));
                    </text>
                    }
                    else
                    {
                                            <text>
            g.AddTaskItem(new JSGantt.TaskItem('@item.ID', '@item.NameDevice: @item.Name', '@item.StartDate.Value.AddDays(-7)', '@item.EndDate', '007CFF', '/CMMSCategory/UpdateSchedule/@item.ID', 0, '@item.CreateBy', 50, 0, 1, 1));
                    </text>
                    }
                }
                else
                {
                    <text>
            g.AddTaskItem(new JSGantt.TaskItem('@item.ID', '@item.NameDevice: @item.Name', '@item.StartDate.Value.AddDays(-7)', '@item.EndDate', 'FF0000', '/CMMSCategory/UpdateSchedule/@item.ID', 0, '@item.CreateBy', 50, 0, 1, 1));
                    </text>
                }
            }

            g.Draw();
            g.DrawDependencies();
        }
        else {
            alert("not defined");
        }

    </script>
</div>
<div class="row">
    <div class=" col-md-12">
        <label class="form-control">
            Kế hoạch bảo trì
        </label>
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th width="150px">Mã thiết bị</th>
                        <th>Tên thiết bị</th>
                        <th>Tên hạng mục</th>
                        <th width="200px">Deadline</th>
                        <th width="200px">Tình trạng</th>
                        <th width="50px">Sửa</th>
                        <th width="50px">BT</th>
                    </tr>
                </thead>
                <tbody class="parent">
                    @foreach (var item in Model)
                    {
                    <tr>
                        <td>@item.IDDevice</td>
                        <td>@item.NameDevice</td>
                        <td>@item.Name</td>
                        <td>@item.EndDate.Value.ToShortDateString()</td>
                        @if (item.EndDate < DateTime.Today)
                        {
                            if (item.Status == 2)
                            {
                                <td style="background-color:red">Bỏ lỡ bảo trì</td>
                            }
                            else if (item.Status == 0)
                            {
                                <td style="background-color:red">Bảo trì trể</td>
                            }
                            else
                            {
                                <td>OK</td>
                            }
                        }
                        else
                        {
                            if (item.Status == 1)
                            {
                            <td style="background-color: aquamarine">Đã bảo trì</td>}
                    else
                    {
                        <td></td>
                    }
                        }
                        <td><a href="/CMMSCategory/UpdateSchedule/@item.ID"><span class='fa fa-eye' style="font-size: 22px;"></span></a> </td>
                        <td><a href="/CMMSCategory/CMMSPerform1/@item.IDCategory"><span class='fa fa-wrench' style="font-size: 22px;"></span></a> </td>

                    </tr>

                    }
                </tbody>
            </table>

        </div>
    </div>
</div>