@model List<Model.EF.CMMSCategory>

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    Model.EF.Device Device = ViewBag.Device;
    Model.EF.FullCategory Item;
    var i = 0;
    List<SelectListItem> listVT = new List<SelectListItem>();
    List<SelectListItem> listTB = new List<SelectListItem>();

}
@section jsFooter
{
    <script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
    <script>
        $(function () {
            $('.form_datetime').datetimepicker({
                format: 'mm/dd/yyyy hh:ii',
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
            });
            $('.select2').select2()

        })
    </script>

    <script src="~/Scripts/FindNameItem.js"></script>
    <script src="~/Scripts/CMMSCategory.js"></script>
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Chỉnh sửa Hạng mục Bảo trì</h3>
    </div>
    @using (Html.BeginForm("Create", "CMMSCategory", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">
            <div class="row">
                <div class=" col-md-12">
                    <label class="control-label" style="text-align: left; display: block; ">Chọn thiết bị</label>
                    <div class='input-group'>
                        @Html.TextBox("abcd", Device.ID + ": " + Device.Name, new { @class = "form-control", ID = "abcd", @Readonly = true })
                        <button type="button" data-toggle="modal" data-target="#copydevice" style="color: red; background-color:darkgoldenrod; width: 50px; height: 50px ; "><span class="fa fa-clone"></span></button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class=" col-md-6">
                    <label class="form-control">
                        Hạng mục bảo trì:
                        <button type="button" data-toggle="modal" data-target="#toolModal" style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                    </label>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover" id="gvCustomers1">
                            <thead>
                                <tr>
                                    <th>Tên</th>
                                    <th width="160px">Chu kỳ (ngày)</th>
                                    <th width="160px">Ghi chú</th>
                                    <th width="50px">Sửa</th>
                                    <th width="50px">Xóa</th>
                                </tr>
                            </thead>
                            <tbody style="background-color: #6bbac7">
                                @foreach (var item in Model)
                                {
                                <tr id="row_@item.ID" onclick="GetDetail(@item.ID, '@item.Name', @item.Cycle, @item.IDDevice, '@item.Note')" class="rows">
                                    <td> @item.Name</td>
                                    <td> @item.Cycle</td>
                                    <td> @item.Note</td>
                                    <td>
                                        <button type="button" data-toggle="modal" data-target="#toolModalEdit" style="color: dodgerblue; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-wrench"></span></button>
                                    </td>
                                    <td>
                                        <button type="button" onclick="deleteCat(@item.ID)" class="xoadongCat" style="color: #f44336; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-trash"></span></button>
                                    </td>

                                </tr>

                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class=" col-md-6">

                    <label class="form-control">
                        Vật tư:
                        <button type="button" data-toggle="modal" data-target="#toolModal1" style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                    </label>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th width="150px">Mã vật tư</th>
                                    <th>Tên vật tư</th>
                                    <th width="100px">Số lượng</th>
                                    <th width="50px">ĐVT</th>
                                    <th>Ghi chú</th>
                                    <th width="50px">Sửa</th>
                                    <th width="50px">Xóa</th>
                                </tr>
                            </thead>
                            <tbody id="gvCustomers2">
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>

            <script>
                $(document).ready(function () {
                    $(window).keydown(function (event) {
                        if (event.keyCode == 13) {
                            event.preventDefault();
                            return false;
                        }
                    });
                });
            </script>

        </div>

    }
</div>
<div id="myForm">
    <div class="modal fade" id="toolModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm Hạng mục</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-9">
                            <label class="control-label col-md-12">Lý do</label>
                            <input type="text" class="form-control" id="reason" />
                        </div>
                        <div class="col-md-3">
                            <label class="control-label col-md-12">Chu kỳ (Ngày)</label>
                            <input type="number" min="1" max="365" class="form-control" id="cycle" />
                        </div>
                        <div class="col-md-12">
                            <label class="control-label col-md-12">Ghi chú</label>
                            <input type="text" class="form-control" id="note" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="createP" class="btn-addCat" style="background: red; padding: 7px;  color: white;">Lưu thông tin</a>
                </div>
                <script>
                    $(document).ready(function () {
                        $("#createP").mouseenter(function () {
                            $('#createP').attr("data-reason", $('#reason').val());
                            $('#createP').attr("data-cycle", $('#cycle').val());
                            $('#createP').attr("data-note", $('#note').val());
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
<div id="EditForm">
    <div class="modal fade" id="toolModalEdit" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Sửa</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-9">
                            <label class="control-label col-md-12">Lý do</label>
                            <input type="text" class="form-control" id="reasonedit" />
                            <input type="hidden" class="form-control" id="idedit" />
                        </div>
                        <div class="col-md-3">
                            <label class="control-label col-md-12">Chu kỳ (Ngày)</label>
                            <input type="number" min="1" max="365" class="form-control" id="cycleedit" />
                        </div>
                        <div class="col-md-12">
                            <label class="control-label col-md-12">Ghi chú</label>
                            <input type="text" class="form-control" id="noteedit" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="editCat" class="btn-editCat" style="background: red; padding: 7px;  color: white;">Thay đổi thông tin</a>
                </div>
                <script>
                    $(document).ready(function () {
                        $("#editCat").mouseenter(function () {
                            $('#editCat').attr("data-reasonedit", $('#reasonedit').val());
                            $('#editCat').attr("data-cycleedit", $('#cycleedit').val());
                            $('#editCat').attr("data-idedit", $('#idedit').val());
                            $('#editCat').attr("data-noteedit", $('#noteedit').val());
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
<div id="EditForm1">
    <div class="modal fade" id="EditItemForm" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm Key milestone</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="control-label col-md-12">Số lượng</label>
                            <input type="number" min="1" max="365" class="form-control" id="edititemamount" />
                            <input type="hidden" class="form-control" id="edititemid" />
                        </div>
                        <div class="col-md-9">
                            <label class="control-label col-md-12">Note</label>
                            <input type="text" min="1" max="365" class="form-control" id="edititemnote"/>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="editItem" class="btn-editItem" style="background: red; padding: 7px;  color: white;">Thay đổi thông tin</a>
                </div>
                <script>
                    $(document).ready(function () {
                        $("#editItem").mouseenter(function () {
                            $('#editItem').attr("data-edititemid", $('#edititemid').val());
                            $('#editItem').attr("data-edititemamount", $('#edititemamount').val());
                            $('#editItem').attr("data-edititemnote", $('#edititemnote').val());
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
<div id="Copy">
    <div class="modal fade" id="copydevice" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm Key milestone</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="control-label">Tìm tên thiết bị</label>
                            <div class="input-group">
                                <input type="text" class="form-control tentb" id="tentb" placeholder="chỉ hiện 20 kết quả gần giống nhất">
                                <div class="input-group-append btnFindTBcopy" id="btnFindTBcopy">
                                    <span class="btn btn-default"><i class="fa fa-search"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class=" col-md-6">
                            <label class="control-label">Chọn thiết bị</label>
                            <div class='input-group'>
                                @Html.DropDownList("NewID" ,listTB, new { @class = "form-control", @ID = "newid" })
                            </div>
                            <input type="hidden" id="nametb" name="item.NameDevice" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="copyid" class="btn-copydevice" style="background: red; padding: 7px;  color: white;">Tạo bản sao</a>
                </div>
                <script>
                    $(document).ready(function () {
                        $("#copyid").mouseenter(function () {
                            $('#copyid').attr("data-newid", $('#newid option:selected').val());
                            $('#copyid').attr("data-oldid", @Device.ID);
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
<div id="myForm2">
    <div class="modal fade" id="toolModal1" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm Vật tư</h4>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("AddItem", "CMMSCategory", FormMethod.Post))
                    {
                        <div class="row">
                            <div class="col-md-9">
                                <label class="control-label col-md-12">Hạng mục</label>
                                <input type="text" class="form-control" id="reason1" name="Item.Name" readonly />
                                <input type="hidden" class="form-control" id="id1" name="Item.IDDevice" readonly />
                                <input type="hidden" class="form-control" id="id2" name="Item.ID" readonly />
                            </div>
                            <div class="col-md-3">
                                <label class="control-label col-md-12">Chu kỳ (Ngày)</label>
                                <input type="number" min="1" max="365" class="form-control" id="cycle1" name="Item.Cycle" readonly />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="control-label">Tìm tên vật tư</label>
                                <div class="input-group">
                                    <input type="text" class="form-control tenvt" id="tenvt" placeholder="chỉ hiện 20 kết quả gần giống nhất">
                                    <div class="input-group-append btnFindVT" id="btnFindVT">
                                        <span class="btn btn-default"><i class="fa fa-search"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class=" col-md-6">
                                <label class="control-label">Chọn vật tư muốn đề nghị</label>
                                <div class='input-group'>
                                    @Html.DropDownList("abc", listVT, new { @class = "form-control" })
                                    <div class="input-group-append" id="btnAddVT">
                                        <span class="btn btn-default"><i class="fa fa-cart-plus"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="gvCustomers">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 60px;width: 60px;">Xóa </th>
                                            <th style="min-width: 400px;width:400px">Thông tin vật tư</th>
                                            <th style="min-width:400px">Ghi chú</th>

                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>


                                <script>
                                    var count = $('#gvCustomers tr').length - 1;
                                    $(document).ready(function () {
                                        function addRowVT() {
                                            var vattu = $('#abc option:selected').text();
                                            const array = vattu.split(":");
                                            if ($("#abc").val() != null) {
                                                var html =
                                                    '<tr id="dong_' + (count + 1) + '">' +
                                                    '<td> <button type="button" data-sodong="' + (count + 1) + '" class="xoadongR"style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-trash"></span></button></td>' +
                                                    '<td> <input class="form-control" data-val="true" style="width:150px;float:left;" readonly = "true" id="detail_' + count + '__IDItem" name="detail[' + count + '].IDItem" placeholder="mã vt" type="text" value="' + $("#abc").val() + '">' +
                                                    '<input class="form-control" data-val="true" style="width:140px;float:left; background:#f798c4"type="number" id="detail_' + count + '__Amount" name="detail[' + count + '].Amount" placeholder="số lượng" type="number" min ="0" value="">' +
                                                    '<input class="form-control" data-val="true" style="width:80px;float:left;" readonly = "true" id="detail_' + count + '__DVT" name="detail[' + count + '].DVT" placeholder="đơn vị tính" type="text" value="' + array[2] + '">' +
                                                    '<input class="form-control" data-val="true"  readonly = "true" data-val-required="The MaterialName field is required." id="detail_' + count + '__Name" name="detail[' + count + '].Name" placeholder="tên vật tư" type="text" value="' + array[1] + '"></td>' +
                                                    '<td><textarea class="form-control" data-val="true"  id="detail_' + count + '__Note" name="detail[' + count + '].Note" placeholder="ghi chú" type="text" rows="2" ></textarea></td>' +

                                                    '</tr>'
                                                count = count + 1;
                                                $(html).appendTo($("#gvCustomers"))
                                            }
                                        };
                                        $("#btnAddVT").click(addRowVT);
                                    });
                                </script>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="luulai">Lưu</button>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

