@model PagedList.IPagedList<Model.View.ProposalToBuyView4>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    DateTime homnay = DateTime.Now;
}

@section jsFooter
{
    <script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
    <script>
        $(function () {
            $('.form_datetime').datetimepicker({
                format: 'mm/dd/yyyy hh:ii',
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
            });
            $('.select2').select2()
        })
    </script>
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-12">
        <div class="card card-success card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fa fa-clipboard"></i>Vật Tư Đã Duyệt</h3>
                <div class="card-tools">
                    <a class="btn btn-warning float-right" href="/ProposalToBuy/SearchAdvanceBuy">Advanced Search</a>
                    <div style="float:left">
                        @using (Html.BeginForm("ListforPO", "ProposalToBuy", FormMethod.Get))
                        {
                            <div class="input-group " style="width: 300px;">
                                <input type="text" value="@ViewBag.SearchString" name="searchString" class="form-control float-right" placeholder="tìm kiếm">
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive parent">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th width="30px"><input type="checkbox" class="checkall"></th>
                                <th>Số phiếu</th>
                                <th>Mã VT</th>
                                <th style="width:200px">Tên vật tư (ghi chú)</th>
                                <th>ĐVT</th>
                                <th>Số lượng</th>
                                <th>Giá</th>
                                <th>Nhà Cung Cấp</th>
                                <th>Người YC</th>
                                <th>Deadline</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr id="row_@item.ID">
                                    <td>  <input type="checkbox" class="abc" name="@item.ID-@item.No"></td>
                                    <td><a href="/ProposalToBuy/Buy?searchString=@item.ID">@item.ID</a></td>
                                    <td>@item.MaterialID</td>
                                    <td>@item.MaterialName (@item.Note)</td>
                                    <td>@item.Unit</td>
                                    <td>@item.Quantity</td>
                                    <td>@if (@item.Price != null)
                                    {@item.Price.Value.ToString("N0").Replace(',', '.')}</td>
                                    <td>@item.VendorName</td>
                                    <td>@item.CreateBy</td>
                                    <td>@item.LimitedDate</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                   
                    @Html.PagedListPager(Model, page => Url.Action("ListforPO", new { page, @searchString = @ViewBag.SearchString }))
                </div>
            </div>
        </div>
        <div class="muahang" style="display:none">
            <button type="submit" class="btn btn-primary" id="luulai">Tạo PO cho các Vật Tư đã chọn</button>
            <span id="fileinput" style="display:none"></span>

        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(".abc").change(function () {
            GetValueModel();
        });
        $(".checkall").change(function () {

            if ($('.checkall:checked').val() !== undefined) {
                $('.abc').prop('checked', 'checked');
            }
            else {
                $('.abc').prop('checked', false);
            }
            GetValueModel();
        });
        function GetValueModel() {

            var names = $('.parent input:checked').map(function () { return this.name; }).get();
            //$(".ketqua").text(names);
            //$(".ketqua").val(names);
            if (names.length > 0) {
                $(".muahang").attr("style", "display:inherit");
                var arr = names;
                var i = 0
                $('#fileinput').html('');
                for (i = 0; i < names.length; i++) {
                    $('#fileinput').html($('#fileinput').html() + '<input type="text" id="chuoi_' + i + '"  name="chuoi[' + i + ']" value="' + arr[i] + '"/>');
                }
            }
            else {
                $(".muahang").attr("style", "display:none");
            }
        };
    });
</script>



