@model PagedList.IPagedList<Model.View.ProposalToBuyView2>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    DateTime homnay = DateTime.Now;
}

@section jsFooter
{
    <script src="/Scripts/ChangeStatusBought.js"></script>
    <script src="/Scripts/ChangeStatusImport.js"></script>
    <script src="/Scripts/ChangeStatusRecive.js"></script>
<script src="/Scripts/AddImportDate.js"></script>
<script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
<script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>

<script>
    $(function () {
        $('.form_datetime').datetimepicker({
            format: 'mm/dd/yyyy hh:ii',
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
        });
        $('.select2').select2()

    })
</script>

}

<div class="row">
    <div class="col-md-12">
        <div class="card card-success card-outline">

            <div class="card-header">
                <h3 class="card-title"><i class="fa fa-clipboard"></i>Vật Tư Đã Duyệt</h3>

                <div class="card-tools">
                    <div class="btn-group" style="height:37px">
                        <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-filter"></i>
                        </button>
                        <div class="dropdown-menu float-right" role="menu">
                            <a href="/ProposalToBuy/SearchAdvanceBuy" style="color:black;" class="dropdown-item">Tìm theo tình trạng</a>
                            <a href="/ProposalToBuy/SearchAdvanceCost" style="color:black;" class="dropdown-item">Tìm theo chi phí</a>

                        </div>
                        
                    </div>
                 
                    <div style="float:left">
                        @using (Html.BeginForm("Buy", "ProposalToBuy", FormMethod.Get))
                        {
                            <div class="input-group " style="width: 300px;">
                                <input type="text" value="@ViewBag.SearchString" name="searchString" class="form-control float-right" placeholder="tìm kiếm">
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        }
                    </div>

                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Số phiếu</th>
                                <th>STT</th>
                                <th>Tên vật tư</th>
                                <th>Số lượng</th>
                                <th>Người yêu cầu</th>
                                <th>Bộ Phận</th>
                                <th>NV Mua Hàng phụ trách</th>
                                <th width="90px">Hạn phải mua</th>
                                <th width="90px">Ngày nhập kho</th>
                                <th>Đã mua</th>
                                <th>Nhập kho</th>
                                <th>Nhận vật tư</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {

                                <tr id="row_@item.ID">
                                    <td><a href="/ProposalToBuy/Buy?searchString=@item.ID">@item.ID</a></td>
                                    <td>@item.No</td>
                                    <td>@item.MaterialID - @item.MaterialName ( @item.Note )  ĐVT: @item.Unit </td>
                                    <td>@item.Quantity</td>
                                    <td><a href="/ProposalToBuy/Buy?searchString=@item.FullName">@item.FullName</a></td>
                                    <td><a href="/ProposalToBuy/Buy?searchString=@item.Department">@item.Department</a></td>
                                    <td>@item.NvMH</td>
                                    <td>@item.LimitedDate.ToString("dd/MM/yyyy")</td>
                                    @if (item.ImportDate == null)
                                    {
                                        if (item.LimitedDate.Subtract(homnay).Days >= 0)
                                        {
                                            <td style="background: #5bc0de; color: white;">chưa đến hạn</td>
                                        }
                                        else
                                        {
                                            <td style="background: #d9534f; color:white;">trễ hạn</td>
                                        }
                                    }
                                    else
                                    {
                                        if (item.ImportDate.Value.Subtract(item.LimitedDate).Days > 0)
                                        {
                                            <td style="background: #d9534f; color: white;">@item.ImportDate.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td style="background: #5cb85c; color: white;">@item.ImportDate.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                    }
                                    <td width="70px"><a href="#" class="btn-bought" data-id="@item.ID" data-no="@item.No">@Html.Raw(item.Bought ? "<span class='fa fa-check fa-2x'></span>" : "<span class='fa fa-times fa-2x'></span>")</a></td>
                                    <td width="70px">
                                        <a href="#" class="btn-imported" data-id="@item.ID" data-no="@item.No">@Html.Raw(item.Imported ? "<span class='fa fa-check fa-2x'></span>" : "<span class='fa fa-times fa-2x'></span>")</a>
                                        <a href="#" class="themgia btn btn-primary btn-circle" data-id="@item.ID" data-no="@item.No" data-toggle="modal" data-target="#upModal" title="Cập Nhật Thời Gian"> <i class="fa fa-list"></i></a>
                                    </td>
                                    <td width="70px"><a href="#" class="btn-recived" data-id="@item.ID" data-no="@item.No">@Html.Raw(item.Recived ? "<span class='fa fa-check fa-2x'></span>" : "<span class='fa fa-times fa-2x'></span>")</a></td>
                                </tr>
                            }


                        </tbody>
                    </table>
                    @Html.PagedListPager(Model, page => Url.Action("Buy", new { page, @searchString = @ViewBag.SearchString }))
                </div>
                <!-- /.table-responsive -->
            </div>
        </div>

    </div>
        </div>



        <form id="myForm" method="post">
            <div class="modal fade" id="upModal" role="dialog">
                <div class="modal-dialog">

                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" style="width:20px">&times;</button>
                            <h4 class="modal-title">Cập nhật thời gian nhập kho</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">

                                <div class="col-md-12">
                                    <div class="form-group">
                                   
                                        <div class="input-group date form_datetime" data-link-field="ngaynhap">
                                            <input class="form-control" type="text" value="" readonly>
                                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                                            <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                        <input type="hidden" id="ngaynhap" name="ngaynhap" value="" /><br />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script src="~/Scripts/jquery-1.9.1.min.js"></script>
                        <script>
                            $(document).ready(function () {

                                $("#ngaynhap").blur(function () {
                                    $('#createCC').attr("data-ngaynhap", $('#ngaynhap').val());
                                });
                                $(".themgia").click(function () {
                                    var today = new Date();
                                    $('#createCC').attr("data-id", $(this).attr("data-id"));
                                    $('#createCC').attr("data-no", $(this).attr("data-no"));
                                    $('#createCC').attr("data-ngaynhap", today.getMonth() + 1 + "/" + today.getDate() + "/" + today.getFullYear() + " " + today.getHours() + ":" + today.getMinutes());
                                    $('#ngaynhap').val(today.getMonth() + 1 + "/" + today.getDate() + "/" + today.getFullYear() + " " + today.getHours() + ":" + today.getMinutes());
                                });
                                $("#createCC").focus(function () {
                                    $('#createCC').attr("data-ngaynhap", $('#ngaynhap').val());
                                });
                            });
                        </script>

                        <div class="modal-footer">
                            <a href="#" id="createCC" class="btn-importedDate" data-idper="" style="background: red;    padding: 7px;  color: white;">Lưu thông tin</a>
                        </div>
                    </div>

                </div>
            </div>
        </form>
