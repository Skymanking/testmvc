@model Model.View.FullProject

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var lenght = Model.detail.Count();
    var lenght2 = Model.member.Count();
    var listU = (IEnumerable<Model.View.UserView2>)ViewBag.listUser;
    var nguoinhan = new List<SelectListItem>();
    nguoinhan.Add(new SelectListItem
    {
        Text = "Chọn Người Tham Gia",
        Value = "none",
        Selected = true
    });
    foreach (var item in listU)
    {
        nguoinhan.Add(new SelectListItem
        {
            Text = item.FullName,
            Value = item.UserName,
        });
    }
    List<SelectListItem> tinhtrang = new List<SelectListItem>();
    tinhtrang.Add(new SelectListItem
         {
             Text = "Working",
             Value = "0",
             Selected = true
         });
    tinhtrang.Add(new SelectListItem
    {
        Text = "Done",
        Value = "1",
    });
    tinhtrang.Add(new SelectListItem
    {
        Text = "Delay",
        Value = "2",
    });
    tinhtrang.Add(new SelectListItem
    {
        Text = "Cancel",
        Value = "3",
    });


}
@section jsFooter
{
    <script src="/Scripts/AddMemberProject.js"></script>
    <script src="/Scripts/ChangeStatusMemberProject.js"></script>
<script src="/Scripts/ChangeTaskMemberProject.js"></script>
    <script src="/Scripts/RemoveMemberProject.js"></script>
    <script src="/Scripts/AddKeyProject.js"></script>
}

<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<script>
    $(function () {
        $(".date").datepicker();
        $('.select2').select2()
    })
</script>
<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Thông tin Dự Án</h3>
    </div>
    @using (Html.BeginForm("Edit2", "Project", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">
            <div class="row">
                <div style="display:none;">@Html.TextBoxFor(model => model.item.ID, new { @class = "form-control" })</div>
                <div class="col-md-5">
                    <label class="control-label col-md-12">Tên Dự Án</label>
                    @Html.TextBoxFor(model => model.item.Name, new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    <label class="control-label col-md-12">Tên Khách Hàng</label>
                    @Html.TextBoxFor(model => model.item.Customer, new { @class = "form-control" })
                </div>
                <div class="col-md-1">
                    <label class="control-label col-md-12">Status</label>
                    @Html.DropDownListFor(model => model.item.Status,tinhtrang, new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    <label>Ngày bắt đầu:</label>
                    <div class="input-group mb-3">
                        <input class="date form-control" type="text" id="item_StartDate" name="item.StartDate" value='@Model.item.StartDate.ToString("MM/dd/yyyy")'>
                        <div class=" input-group-append">
                            <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <label>Ngày kết thúc:</label>
                    <div class="input-group mb-3">
                        <input class="date form-control" type="text" id="item_EndDate" name="item.EndDate" value='@Model.item.EndDate.ToString("MM/dd/yyyy")'>
                        <div class=" input-group-append">
                            <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <label class="control-label col-md-12">Diễn giải chi tiết</label>
                    @Html.TextAreaFor(model => model.item.Description, new { @class = "form-control", @rows = "4" })
                </div>
            </div>

            <div class="row">
                <label class="form-control">
                    Các Key milestone của dự án:
                    <button type="button" data-toggle="modal" data-target="#toolModal" style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                </label>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="gvCustomers">
                        <thead>
                            <tr>
                               
                                <th>Key milestone</th>
                                <th width="160px">StartDate</th>
                                <th width="160px">EndDate</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < lenght; i++)
                            {
                                <tr id="row">                                  
                                    <td>
                                        <span style="display:none;">@Html.TextBoxFor(model => model.detail[i].ID, new { @class = "form-control", @placeholder = "" })</span>
                                        @Html.TextBoxFor(model => model.detail[i].Name, new { @class = "form-control", @placeholder = "" })
                                    </td>
                                    <td>
                                        <div class="input-group mb-3">
                                            @*<input class="date form-control" type="text" id="detail_i_StartDate" name="detail[i].StartDate" value='@Model.detail[i].StartDate.ToString("MM/dd/yyyy")'>*@
                                            @Html.TextBoxFor(model => model.detail[i].StartDate, new { @class = "date form-control"})
                                            <div class=" input-group-append">
                                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-group mb-3">
                                            @Html.TextBoxFor(model => model.detail[i].EndDate, new { @class = "date form-control" })
                                            <div class=" input-group-append">
                                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    
                </div>
            </div>

            <div class="row" style="padding-top:20px;">
                <label class="form-control">Các thành viên được xem thông tin dự án: 
                    <button type="button" data-toggle="modal" data-target="#myModaladdU" style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                </label>

                @for (var i = 0; i < Model.member.Count; i++)
                {
                    var nguoitemp = new List<SelectListItem>();
                    foreach (var item in nguoinhan)
                    {
                        if (item.Value == Model.member[@i].IDUse)
                        {
                            nguoitemp.Add(new SelectListItem
                            {
                                Text = item.Text,
                                Value = item.Value,
                                Selected = true
                            });
                            break;
                        }
                    }
                    <div class="col-md-4" style="padding-top: 10px;">
                        <div class="input-group">
                            <div class="input-group-append">
                                <span class="input-group-text btn-removeU" data-id="@Model.item.ID" data-nguoimoi="@Model.member[i].IDUse" style="border-radius: 50% 0 0 50%; border-width: 2px; border-style: outset;"><i class="fa fa-trash" style="color: #F44336;"></i></span>
                            </div>
                            @Html.DropDownListFor(model => model.member[i].IDUse, nguoitemp, new { @class = "form-control" })
                            <div class="input-group-append">
                                <span class="input-group-text" style="border-radius:0 50% 50% 0; border-width: 2px; border-style: outset;"><a href="#" class="btn-change" data-pro="@Model.member[i].IDPro" data-use="@Model.member[i].IDUse">@Html.Raw(@Model.member[i].Write ? "<span class='fa fa-edit'></span>" : "<span class='fa fa-eye'></span>")</a></span>
                            </div>
                        </div>
                    </div>
                }
                
                <p></p>
                <p></p>
            </div>
        </div>
    <div class="card-footer" style="margin-top: 50px;">

            <button type="submit" class="btn btn-primary">Lưu thông tin</button>

            @*<span class="btn btn-danger float-right" data-toggle="modal" data-target="#myModalchangeU">Chuyển nhiệm vụ hàng loạt</span>*@

    </div>

    }
</div>


<form id="myFormAddU" method="post">
    <div class="modal fade" id="myModaladdU" role="dialog">
        <div class="modal-dialog" style="max-width: 450px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm thành viên</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class='col-md-12'>
                            <select class='form-control select2' id="nguoimoi" name="nguoimoi" style="width:100%">
                                @foreach (var item in nguoinhan)
                                {
                                    <option value="@item.Value">   @item.Text    </option>
                                }
                            </select>
                        </div>

                    </div>
                </div>
                <script>
                    $(document).ready(function () {

                        $("#createU").mouseenter(function () {
                            $('#createU').attr("data-nguoimoi", $('#nguoimoi').val());
                        });

                    });
                </script>
                <div class="modal-footer">
                    <a href="#" id="createU" class="btn-createU" data-id="@Model.item.ID" style="background: red;    padding: 7px;  color: white;">Lưu thông tin</a>
                </div>
            </div>

        </div>
    </div>

</form>

<div id="myForm">
    <div class="modal fade" id="toolModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                        <h4 class="modal-title" style="position: absolute;">Thêm Key milestone</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">
                                <label class="control-label col-md-12">Tên Key milestone</label>
                                <input type="text" class="form-control" id="keyname"/>
                            </div>
                            <div class="col-md-6">
                                <label>Start Date:</label>
                                <div class="input-group mb-3">
                                    <input class="date form-control" type="text" id="keystart" name="keystart">
                                    <div class=" input-group-append">
                                        <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>EndDate:</label>
                                <div class="input-group mb-3">
                                    <input class="date form-control" type="text" id="keyend" name="keyend">
                                    <div class=" input-group-append">
                                        <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" id="createP" class="btn-createP" data-id="@Model.item.ID" style="background: red; padding: 7px;  color: white;">Lưu thông tin</a>
                    </div>
                    <script>
                        $(document).ready(function () {
                            $("#createP").mouseenter(function () {
                                $('#createP').attr("data-keyname", $('#keyname').val());
                                $('#createP').attr("data-keystart", $('#keystart').val());
                                $('#createP').attr("data-keyend", $('#keyend').val());
                            });
                        });
                    </script>
                </div>
        </div>
    </div>
</div>

<form id="myFormChangeU" method="post">
    <div class="modal fade" id="myModalchangeU" role="dialog">
        <div class="modal-dialog" style="max-width: 450px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Chuyển nhiệm vụ </h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <label>Chuyển tất cả nhiệm vụ trong dự án</label>
                        <label>Từ thành viên:</label>
                        <div class='col-md-12'>
                            <select class='form-control select2' id="user1" name="user1" style="width:100%">
                                @foreach (var item in Model.member)
                                {
                                    <option value="@item.IDUse">   @item.IDUse    </option>
                                }
                            </select>
                        </div>
                        <label>Qua thành viên:</label>
                        <div class='col-md-12'>
                            <select class='form-control select2' id="user2" name="use2" style="width:100%">
                                @foreach (var item in Model.member)
                                {
                                    <option value="@item.IDUse">   @item.IDUse    </option>
                                }
                            </select>
                        </div>

                    </div>
                </div>
                <script>
                    $(document).ready(function () {

                        $("#changeU").mouseenter(function () {
                            $('#changeU').attr("data-user1", $('#user1').val());
                            $('#changeU').attr("data-user2", $('#user2').val());
                        });

                    });
                </script>
                <div class="modal-footer">
                    <a href="#" id="changeU" class="btn-changeU" data-idpro="@Model.item.ID" style="background: red;    padding: 7px;  color: white;">Lưu thông tin</a>
                </div>
            </div>

        </div>
    </div>

</form>
