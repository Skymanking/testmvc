@model List<Model.EF.TodoList>

@{
    ViewBag.Title = "TodoList";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var ListTag = (List<Model.EF.Tags>)ViewBag.ListTag;
    var ListPri = (List<Model.EF.Tags>)ViewBag.ListPri;
    var ListUser = ViewBag.ListUser;

}

@section jsFooter
{
    <script>
        $('.select2').select2()
    </script>
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/TodoList.js"></script>
<div class="card card-primary">
    <div class="row">
        <div class="col-md-2">
            <div style="background-color:white;  border-radius: 10px;">
                <div style="padding:10px;">
                    <a href="/TodoList/TodoList" class="btn btn-primary btn-block mb-3" style="color:white">
                        <label>Todo List</label>
                    </a>
                    <div style="background-color: @(ViewBag.Menu == "All" ? "#e9f1f5":"")">
                        <a href="/TodoList/TodoList?Menu=All" class="nav-link">
                            <i class="fa fa-2x fa-pencil-square-o"></i>
                            <label>All Task</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Done" ? "#e9f1f5":"")">
                        <a href="/TodoList/TodoList?Menu=Done" class="nav-link">
                            <i class="fa fa-2x fa-star-o"></i>
                            <label>Done</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Important" ? "#e9f1f5":"")">
                        <a href="/TodoList/TodoList?Menu=Important" class="nav-link">
                            <i class="fa fa-2x fa-star-o"></i>
                            <label>Important</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Trash" ? "#e9f1f5":"")">
                        <a href="/TodoList/TodoList?Menu=Trash" class="nav-link">
                            <i class="fa fa-2x fa-trash-o"></i>
                            <label>Trash</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Share" ? "#e9f1f5":"")">
                        <a href="/TodoList/TodoList?Menu=Share" class="nav-link">
                            <i class="fa fa-2x fa-share-alt"></i>
                            <label>Share With Me</label>
                        </a>
                    </div>
                    <label>
                        Priority
                    </label>

                    @foreach (var pri in ListPri)
                    {
                        <div class="row">
                            <div onclick="Search('@pri.Name')" class="nav-link col-md-10" style="color:@pri.Color; font-weight: bolder; background-color: @(ViewBag.Tags != null && ViewBag.Tags.Contains(pri.Name) ? "#e9f1f5":"")">
                                &nbsp;<i class="fa fa-modx"></i>
                                @pri.Name
                            </div>
                        </div>
                    }
                    <label>
                        Tags
                    </label>
                    @foreach (var tag in ListTag)
                    {<div class="row">
                            <div onclick="Search('@tag.Name')" class="nav-link col-md-10" style="color:@tag.Color; font-weight: bolder; background-color: @(ViewBag.Tags != null && ViewBag.Tags.Contains(@tag.Name) ? "#e9f1f5":"")">
                                &nbsp;<i class="fa fa-modx"></i>
                                @tag.Name
                            </div>
                            @if (tag.UserName != "All")
                            {
                                <div class="col-md-2" data-toggle="modal" data-target="#EditTag" style="float:right;" id="@tag.ID" onclick="EditTag(@tag.ID)"><i class="fa fa-wrench"></i></div>
                            }
                        </div>
                    }
                    <button class="btn btn-block" data-toggle="modal" data-target="#CreateTag">
                        &nbsp;<span class="fa fa-plus" style="color:red"></span>
                        New Tag
                    </button>
                </div>
                <div style="height: 10%; padding: 10px;">
                    <center>
                        <button type="button" style="width: 100%; height: 30px; border-radius: 6px; background-color:blue; border: none; color: white;" data-toggle="modal" data-target="#CreateModal">+ Add New Task</button>
                    </center>
                </div>
            </div>
        </div>
        <button style="display:none" type="submit"></button>
        <div class="col-md-10">
            <div class="card card-primary card-outline">
                <div class="card-header">
                    <h2 class="card-title">Task</h2>
                    <div class="card-tools">
                        @using (Html.BeginForm("TodoList", "TodoList", FormMethod.Get))
                        {
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control" placeholder="Search" name="SearchString" id="searchText" value="@ViewBag.SearchString">
                                <div class="input-group-append">
                                    <input type="hidden" name="Tags" value="@ViewBag.Tags" id="searchTag" />
                                    <input type="hidden" name="Menu" value="@ViewBag.Menu" id="searchMenu" />
                                    <button type="submit" class="btn btn-primary" id="btnSearch"><i class="fa fa-search"></i></button>
                                </div>
                                <button type="button" data-toggle="modal" data-target="#CreateModal" style="float:right; color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>

                            </div>}
                    </div>
                </div>
                <div class="card-body p-0">
                    <div>
                        <table class="table table-hover">
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr id="Task_@item.ID">
                                        <td style="width:30px" onclick="ChangeImportant(@item.ID)" id="important_@item.ID">
                                            @if (item.Important)
                                            {
                                                <i class="fa fa-2x fa-star" style="color: #ffc30e"></i>
                                            }
                                            else
                                            {<i class="fa fa-star-o" style="color: #ffeb3b"></i>}
                                        </td>
                                        <td data-toggle="modal" data-target="#EditModal" onclick="EditTask(@item.ID)" style="min-width:300px">
                                            <label class="text">@item.Name </label><br />
                                            <span class="text">@item.Description </span>
                                        </td>
                                        <td style="width:150px">
                                            @if (!string.IsNullOrEmpty(item.Priority))
                                            {
                                                foreach (var tag in item.Priority.Split(',').ToList())
                                                {
                                                    try
                                                    {
                                                        var itemTag = ListPri.Where(x => x.Name == tag).FirstOrDefault();
                                                        <button style="font-size: 10px; border: 2px solid black; border-radius: 10px; background-color: white; border-color: @itemTag.Color; color: @itemTag.Color; ">
                                                            @itemTag.Name
                                                        </button>
                                                    }
                                                    catch { }
                                                }
                                            }
                                            @if (!string.IsNullOrEmpty(item.Tags))
                                            {
                                                foreach (var tag in item.Tags.Split(',').ToList())
                                                {
                                                    try
                                                    {
                                                        var itemTag = ListTag.Where(x => x.Name == tag).FirstOrDefault();
                                                        if (itemTag != null)
                                                        {
                                                            <button style="font-size: 10px; border: 2px solid black; border-radius: 10px; background-color: white; border-color: @itemTag.Color; color: @itemTag.Color; ">
                                                                @itemTag.Name
                                                            </button>
                                                        }
                                                    }
                                                    catch { }
                                                }
                                            }
                                        </td>
                                        <td style="width:100px">
                                            <span style="color: #03a9f4">@item.EditDate.ToShortDateString()</span>
                                        </td>
                                        <td style="width:70px">
                                            @if (string.IsNullOrEmpty(item.User))
                                            {
                                                <img src="~/Assets/theme3/dist/img/logo.png" class="brand-image img-circle elevation-3" />}
                                            else
                                            {
                                                <img src="@item.User" class="brand-image img-circle elevation-3" />
                                            }
                                        </td>
                                        <td style="width:30px" onclick="Done(@item.ID)" id="done_@item.ID">
                                            @if (item.Done)
                                            {
                                                <i class="fa fa-check" style="color:red"></i>
                                            }
                                            else
                                            { <i class="fa fa-times-circle"></i>}
                                        </td>
                                        @if (ViewBag.Menu == "Trash")
                                        {
                                            <td style="width:70px" onclick="Hidden(@item.ID,0)" id="hidden_@item.ID">
                                                <i class="fa fa-undo" style="color: cornflowerblue" o></i>
                                            </td>
                                        }
                                        else
                                        {
                                            <td style="width:70px" onclick="Hidden(@item.ID,1)" id="hidden_@item.ID">
                                                <i class="fa fa-trash-o" style="color:red" o></i>
                                            </td>
                                        }

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="CreateTagForm">
    <div class="modal fade" id="CreateTag" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Add Tag</h4>
                </div>
                @using (Html.BeginForm("AddTag", "TodoList", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Name</label>
                                <input type="text" class="form-control" name="name" id="nametag" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Color</label>
                                <input type="color" name="color" id="color" class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="createTag" style="background: red; padding: 7px;  color: white;" type="submit">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="EditTagForm">
    <div class="modal fade" id="EditTag" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Edit Tag</h4>
                </div>
                @using (Html.BeginForm("EditTag", "TodoList", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Name</label>
                                <input type="text" class="form-control" name="name" id="editnametag" />
                                <input type="hidden" class="form-control" name="id" id="editIDtag" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Color</label>
                                <input type="color" name="color" id="editcolortag" class="form-control" style="height:40px" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="EditTag" class="btn btn-success" style=" padding: 7px;  color: white;" type="submit">Lưu</button>
                        <button id="HidTag" class="btn btn-danger" style="padding: 7px;  color: white;" type="button" onclick="HiddenTag()">Xoá</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="Create">
    <div class="modal fade" id="CreateModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Add Task</h4>
                </div>
                @using (Html.BeginForm("Create", "TodoList", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Title</label>
                                <input type="text" class="form-control" name="title" id="title" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Priority</label>
                                <select class="form-control select2" name="priority" style="width:100%">
                                    @foreach (var pri in ListPri)
                                    {
                                        <option value="@pri.Name">@pri.Name</option>
                                    }
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="control-label col-md-12">Tag</label>
                                <select id="newmember" class="form-control select2" multiple="multiple" data-placeholder="Tag" style="width: 100%;">
                                    @foreach (var tag in ListTag)
                                    {
                                        <option value="@tag.Name">@tag.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="tag" name="tag" value="" />

                            </div>
                            <div class="col-md-12">
                                <label class="control-label col-md-12">Share</label>
                                <select id="share" class="form-control select2" style="width:100%" multiple="multiple" data-placeholder="Share">
                                    @foreach (var user in ListUser)
                                    {
                                        <option value="@user.ID">@user.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="shareList" name="user" value="" />
                            </div>

                            <div class="col-md-12">
                                <label class="control-label col-md-12">Description</label>
                                <textarea class="form-control" name="desc" rows="4"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="createP" style="background: red; padding: 7px;  color: white;" type="submit" onclick="CheckUser(1)">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="EditTask">
    <div class="modal fade" id="EditModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Edit Task</h4>
                </div>
                @using (Html.BeginForm("Edit", "TodoList", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Title</label>
                                <input type="text" class="form-control" name="title" id="edittitle" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Priority</label>
                                <select class="form-control select2" name="priority" style="width:100%" id="editpri">
                                    @foreach (var pri in ListPri)
                                    {
                                        <option value="@pri.Name">@pri.Name</option>
                                    }
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="control-label">Tags</label> &nbsp; &nbsp; <span id="oldtags" style="color:burlywood"></span>
                                <select id="editmember" class="form-control select2" multiple="multiple" data-placeholder="Share" style="width: 100%;">
                                    @foreach (var tag in ListTag)
                                    {
                                        <option value="@tag.Name">@tag.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="edittag" name="tag" value="" />
                                <input type="hidden" id="editID" name="id" value="" />
                            </div>
                            <div class="col-md-12">
                                <label class="control-label">Share</label> &nbsp; &nbsp; <span id="oldshare" style="color:burlywood"></span>
                                <select class="form-control select2" name="share" multiple="multiple" style="width:100%" id="editshare" data-placeholder="Share">
                                    @foreach (var user in ListUser)
                                    {
                                        <option value="@user.ID">@user.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="editListshare" name="user" value="" />
                            </div>

                            <div class="col-md-12">
                                <label class="control-label col-md-12">Description</label>
                                <textarea class="form-control" name="desc" rows="4" id="editdes"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="createP" style="background: red; padding: 7px;  color: white;" type="submit" onclick="CheckUser(2)">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

