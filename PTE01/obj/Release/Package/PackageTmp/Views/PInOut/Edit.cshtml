@model Model.View.PInOut2
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var detail = (List<Model.EF.DetailPInOut>)ViewBag.detail;

    List<SelectListItem> noiden1 = new List<SelectListItem>();
    noiden1.Add(new SelectListItem
    {
        Text = "Xưởng 1",
        Value = "1",
        Selected = true
    });
    noiden1.Add(new SelectListItem
    {
        Text = "Xưởng 2",
        Value = "2",
    });
    noiden1.Add(new SelectListItem
    {
        Text = "Xưởng 3",
        Value = "3",
    });
    noiden1.Add(new SelectListItem
    {
        Text = "Xưởng Long Hậu",
        Value = "4",
    });
    noiden1.Add(new SelectListItem
    {
        Text = "Về không trở lại",
        Value = "-1",
    });
    noiden1.Add(new SelectListItem
    {
        Text = "Khác",
        Value = "0",

    });

    List<SelectListItem> noiden2 = new List<SelectListItem>();
    noiden2.Add(new SelectListItem
         {
             Text = "Sẽ đem hàng về lại",
             Value = "1",
             Selected = true
         });
    noiden2.Add(new SelectListItem
         {
             Text = "Không đem hàng về lại",
             Value = "0",
         });
    List<SelectListItem> lydo1 = new List<SelectListItem>();
    lydo1.Add(new SelectListItem
         {
             Text = "Cá nhân",
             Value = "1",
         });
    lydo1.Add(new SelectListItem
         {
             Text = "Tan ca",
             Value = "2",
         });
    lydo1.Add(new SelectListItem
    {
        Text = "Công việc CTY",
        Value = "3",
    });

}
@section jsFooter
{
    <script src="/Scripts/AppovalPInOut.js"></script>
    <script src="/Assets/plugin/ckfinder/ckfinder.js"></script>
    <script src="/Assets/theme3/plugins/timepicker/bootstrap-timepicker.min.js"></script>
    <script>
        $(function () {

            $('.select2').select2()
            $('.time1').timepicker({
                showInputs: false,
                showMeridian: false
            })
            $('.time2').timepicker({
                showInputs: false,
                showMeridian: false
            })
            $(".date").datepicker();
        })
    </script>

    <script>
        $(document).ready(function () {
            $('#hinh').attr('src', $('#GImage').val());
            if ($('.cohh').is(':checked')) {
                $("#showhh").show();
            }
            else {
                $("#showhh").hide();
            }
            $('.cohh').click(function () {
                if ($(this).is(':checked')) {
                    $("#showhh").show();
                }
                else {
                    $("#showhh").hide();
                }
            });

            $('.time1').change(function () {
                var time1 = $(".date").val() + " " + $(".time1").val();
                var time2 = $(".date").val() + " " + $(".time2").val();
                if (time1 >= time2) {
                    $('.thongbao').text("THÔNG BÁO!!!! chọn lại thời gian phù hợp");
                    $('.nutsave').hide();
                }
                else {
                    $('.thongbao').text("");
                    $('.nutsave').show();
                }
            });
            $('.date').change(function () {
                var time1 = $(".date").val() + " " + $(".time1").val();
                var time2 = $(".date").val() + " " + $(".time2").val();
                if (time1 >= time2) {
                    $('.thongbao').text("THÔNG BÁO!!!! chọn lại thời gian phù hợp");
                    $('.nutsave').hide();
                }
                else {
                    $('.thongbao').text("");
                    $('.nutsave').show();
                }
            });
            $('.time2').change(function () {
                var time1 = $(".date").val() + " " + $(".time1").val();
                var time2 = $(".date").val() + " " + $(".time2").val();
                if (time1 >= time2) {
                    $('.thongbao').text("THÔNG BÁO!!!! chọn lại thời gian phù hợp");
                    $('.nutsave').hide();
                }
                else {
                    $('.thongbao').text("");
                    $('.nutsave').show();
                }
            });
        });
    </script>

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">PHIẾU RA VÀO CỔNG</h3>
    </div>
    @using (Html.BeginForm("Edit", "PInOut", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">
            <div class="row">
                <div style="display:none">@Html.TextBoxFor(model => model.ID, new { @class = "form-control"})</div>
                
                <div class='col-md-2'>
                    <label class="control-label">Lý do</label>
                    @Html.DropDownListFor(model => model.Type2, lydo1, new { @class = "form-control", @style = "background: #f3cdd1; font-weight: bold;"  })
                </div>
                <div class='col-md-10'>
                    <label class="control-label">Diễn giải Lý Do</label>
                    @Html.TextBoxFor(model => model.Reason, new { @class = "form-control", })
                </div>
            </div>
            <div class="row">
                <div class='col-md-4'>
                    <label class="control-label">Nhân Viên</label>
                    @Html.DropDownListFor(model => model.PerID, null, new { @class = "form-control select2", })
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Nơi đến</label>
                    @Html.DropDownListFor(model => model.Type1, noiden1, new { @class = "phonghop form-control", })
                </div>
                <div class='col-md-2'>
                    <label>Ngày:</label>
                    <div class="input-group mb-3">
                        @*<input type="text" id="date" class="form-control">*@
                        @Html.TextBoxFor(model => model.Date, new { @class = "date form-control", @autocomplete = "off" })
                        <div class=" input-group-append">
                            <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class='col-md-2'>
                    <div class="bootstrap-timepicker">
                        <div class="form-group">
                            <label>Từ:</label>
                            <div class="input-group">
                                @Html.TextBoxFor(model => model.Time1, new { @class = "time1 form-control", @autocomplete = "off" })
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='col-md-2'>
                    <div class="bootstrap-timepicker">
                        <div class="form-group">
                            <label>Đến:</label>
                            <div class="input-group">
                                @Html.TextBoxFor(model => model.Time2, new { @class = "time2 form-control", @autocomplete = "off" })
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class='col-md-12'>
                    <div class="form-group">
                        <center> <label class="control-label" style="color:red;">Có Mang Theo Hàng Hóa?</label></center>
                        @Html.CheckBoxFor(model => model.Goods, new { @class = "cohh form-control", @style = "height:40px" })
                    </div>
                </div>
            </div>
            <div class="row" id="showhh">
                <div class='col-md-8'>
                    <label class="control-label">Tên Hàng Hóa</label>
                    @Html.TextBoxFor(model => model.GName, new { @class = "form-control", })
                </div>
                <div class='col-md-4'>
                    <label class="control-label">Có mang hàng về không?</label>
                    @Html.DropDownListFor(model => model.GType, noiden2, new { @class = "form-control", })
                </div>
                <div class='col-md-8'>
                    <label class="control-label">Hình hàng hóa</label>
                    <div class='input-group'>
                        @Html.TextBoxFor(model => model.GImage, new { @class = "form-control", @style = "background: #f9d7d4;", @placeholder = "chọn hình hàng hóa" })
                        <div class=" input-group-append">
                            <span class="input-group-text">
                                <a id="btnSelectImage" href="#"><span class="fa fa-image"></span></a>
                            </span>
                        </div>
                    </div>
                    <script>
                        $('#btnSelectImage').on('click', function (e) {
                            e.preventDefault();
                            var finder = new CKFinder();
                            finder.selectActionFunction = function (url) {
                                $('#GImage').val(url);
                                $('#btnViewFile').attr("href", $('#GImage').val());
                                $('#hinh').attr('src', $('#GImage').val());
                            };
                            finder.popup();
                        })

                    </script>

                </div>
                <div class='col-md-4'>
                    <label>Ngày dự kiến mang về:</label>
                    <div class="input-group mb-3">
                        @if(Model.GDate!=null)
                        {<input autocomplete="off" class="date form-control" id="GDate" name="GDate" type="text" value='@Model.GDate.Value.ToString("MM/dd/yyyy")'>}
                        else
                        {<input autocomplete="off" class="date form-control" id="GDate" name="GDate" type="text" value=''> }
                        <div class=" input-group-append">
                            <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <img src="" id="hinh" class="img-thumbnail" style="max-height:600px">
                </div>
                <div class='col-md-12'>
                    <label class="control-label">Chi tiết về hàng hóa</label>
                    @Html.TextAreaFor(model => model.GNote, new { @class = "form-control", @rows = "7", @placeholder = "Số lượng hàng, tên từng loại hàng nếu có...." })
                </div>
                <div class='col-md-12'>
                    <label class="control-label">Ghi chú của HCNS</label>
                    @Html.TextAreaFor(model => model.Note, new { @class = "form-control", @rows = "4" })
                </div>

            </div>

        </div>
        <div class="card-footer">
            <button type="submit" class="nutsave btn btn-primary" onclick="openNav()">Lưu thông tin</button>
            @* <span class="float-right btn btn-outline-success">Duyệt <a href="#" class="btn-approval" data-id="@Model.ID">@Html.Raw(Model.Approval ? "<span class='fa fa-check fa-2x'></span>" : "<span class='fa fa-times fa-2x' style='color:red'></span>")</a></span>*@
            @if (Model.Approval == true)
            {
                <div class="lockscreen-item">
                    <div class="lockscreen-image">
                        <img src="@Model.ApprovalImage" alt="User Image">
                    </div>
                    <form class="lockscreen-credentials">
                        <div class="input-group">
                            <span class="form-control">..............Duyệt ngày @Model.ApprovalTime.Value.ToString("dd/MM/yyyy")</span>

                            <div class="input-group-append">
                                <button type="button" class="btn"><i class="fa fa-check" style="color: #28a745"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
            }
            else
            {
                <div class="lockscreen-item">
                    <div class="lockscreen-image">
                        <img src="/Assets/theme3/dist/img/user.png" alt="User Image">
                    </div>
                    <form class="lockscreen-credentials">
                        <div class="input-group">
                            <span class="form-control">..............Chưa duyệt</span>

                            <div class="input-group-append btn-approval" data-id="@Model.ID">
                                <button type="button" class="btn"><i class="fa fa-times" style="color: #dc3545"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
                @*<span class="float-right btn btn-outline-success">Duyệt <a href="#" class="btn-approval" data-id="@Model.ID"><span class='fa fa-times fa-2x' style='color:red'></span></a></span>*@
            }

            <div class='col-md-12'>
                <span class="thongbao" style="color:red;"></span>
            </div>
        </div>
    }
</div>

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">CHI TIẾT RA VÀO CỔNG</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>Loại</th>
                        <th>Thời gian</th>
                        <th>BV</th>
                    </tr>
                </thead>
                @if (detail != null)
                {
                    foreach (var itemde in detail)
                    {
                        if (@itemde.Type == 0)
                        {
                            <tr>
                                <td>RA</td>
                                <td>@itemde.Time.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@itemde.BV</td>
                            </tr>
                        }
                        if (@itemde.Type == 1)
                        {
                            <tr>
                                <td>VÀO</td>
                                <td>@itemde.Time.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@itemde.BV</td>
                            </tr>
                        }
                        if (@itemde.Type == 2)
                        {
                            <tr>
                                <td>ĐEM RA</td>
                                <td>@itemde.Time.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@itemde.BV</td>
                            </tr>
                        }
                        if (@itemde.Type == 3)
                        {
                            <tr>
                                <td>ĐEM VÀO</td>
                                <td>@itemde.Time.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@itemde.BV</td>
                            </tr>
                        }

                    }
                }
            </table>

        </div>
    </div>
</div>