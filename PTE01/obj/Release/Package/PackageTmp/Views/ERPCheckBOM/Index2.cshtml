@{
    ViewBag.Title = "CheckBOMItem";
    Layout = "~/Views/Shared/_Theme3.cshtml";
}



<h1 style="text-align: center;">QR Code</h1>
<script src="~/Scripts/html5-qrcode.min.js"></script>
<style>
    .result {
        background-color: green;
        color: #fff;
        padding: 20px;
    }

    .row {
        display: flex;
    }
</style>
<div class="row">
    <div class="col col-12" style="padding:30px;">
        <div class="input-group-append">
            <input id="result" name="DeviceID" size="16" placeholder="Quét QR Code thiết bị-->" class="qrcode-text form-control">
            <label class="qrcode-text-btn" onclick="ScanQR()">
                <i class="fa fa-4x fa-qrcode"></i>
            </label>
        </div>

    </div>
    <div class="col col-12">
        <div style="width:500px; margin:auto; display:none" id="reader"></div>
    </div>

</div>
<script type="text/javascript">
    function onScanSuccess(qrCodeMessage) {
        document.getElementById('result').value = qrCodeMessage;
    }
    function onScanError(errorMessage) {
        //handle scan error
    }
    var html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", { fps: 10, qrbox: 250 });
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250, videoConstraints: { facingMode: { exact: "environment" } } });
    }
    html5QrcodeScanner.render(onScanSuccess, onScanError);
    function ScanQR() {
        document.getElementById("reader").style.display = "block";
        clickButton();
    }
    function clickButton() {
        var buttons = document.getElementById('reader__dashboard_section_csr').getElementsByTagName("div");
        buttons[0].getElementsByTagName("button")[0].click();
        let check = "Request Camera Permissions"
        function loop() {
            setTimeout(function () {
                var buttons2 = document.getElementById('reader__dashboard_section_csr').getElementsByTagName("div");
                try {
                    check = buttons2[0].getElementsByTagName("button")[0].innerText;
                    if (check == "Request Camera Permissions") {
                        loop();
                    }
                }
                catch {
                    var buttons2 = document.getElementById('reader__dashboard_section_csr').getElementsByTagName("span");
                    buttons2[1].getElementsByTagName("button")[0].click();
                }
            }, 1000)
        }
        loop();
    }
</script>

