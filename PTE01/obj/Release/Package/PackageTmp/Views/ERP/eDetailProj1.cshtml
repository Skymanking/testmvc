@{
    ViewBag.Title = "View";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var detail = (Model.ERP.proj_mst)ViewBag.detail;
    var task = (List<Model.ERP.projtask_mst>)ViewBag.task;
    var resource = (List<Model.ERP.projmatl_mst>)ViewBag.resource;
}

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title"> Thông Tin Chi Tiết Dự Án - Số: <strong>@detail.proj_num</strong></h3>
    </div>
    <div class="card-body">

        <div class="row">
            <div class="col-3">
                <img class="img-fluid pad" src="~/Assets/theme3/dist/img/noimgpro.png" alt="link hình bị lỗi">

            </div>
            <div class="col-9">
                <h3><a href="/ProposalToBuy/eCreateProTask/?idpro=@detail.proj_num&idtask=0"><i class="fa fa-shopping-cart" aria-hidden="true" style="font-size: 22px;color: #28a745;"></i></a> @detail.proj_desc</h3>
                <h5> Người tạo:<strong style="color:red;">@detail.CreatedBy</strong> Ngày tạo:<strong style="color:red;">@detail.proj_date.ToString("dd/MM/yyyy")</strong></h5>
                <h5>Thời gian:<strong style="color:red;">@detail.eff_date.Value.ToString("dd/MM/yyyy") - @detail.exp_date.Value.ToString("dd/MM/yyyy") </strong> </h5>
                <h5>Loại:<strong style="color:red;">@if (@detail.type == "P") { <span>Project</span>}else{<span>Estimate Project</span>}</strong> </h5>

            </div>

            <div class="col-md-12 parent">
                @if (task != null)
                {
                    foreach (var etask in task)
                    {
                        <div class="invoice p-3 mb-3">
                            <div class="row">
                                <div class="col-12">
                                    <h4><a href="/ProposalToBuy/eCreateProTask/?idpro=@etask.proj_num&idtask=@etask.task_num"><i class="fa fa-shopping-cart" aria-hidden="true" style="font-size: 22px;color: #28a745;"></i></a> TASK SỐ (@etask.task_num) : @etask.task_desc</h4>
                                    <p>Thời gian:<strong style="color:red;">@etask.exp_date.Value.ToString("dd/MM/yyyy") - @detail.exp_date.Value.ToString("dd/MM/yyyy") </strong></p>
                                </div>
                            </div>
                            @if (resource != null)
                            {
                                <div class="row">
                                    <div class="col-12 table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th width="30px"><input type="checkbox" class="checkall"></th>
                                                    <th>STT</th>
                                                    <th>Mã vật tư</th>
                                                    <th>Tên vật tư</th>
                                                    <th>Số lượng</th>
                                                    <th>Cost Code</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var eres in resource)
                                                {

                                                    if (eres.task_num == etask.task_num)
                                                    {
                                                        <tr>
                                                            <td><input type="checkbox" class="abc" name="@eres.item"> </td>
                                                            <td>@eres.seq </td>
                                                            <td>@eres.item</td>
                                                            <td>@eres.item_desc</td>
                                                            <td>@eres.matl_qty.Value.ToString("N3")</td>
                                                            <td>@eres.cost_code</td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            }
                        </div>
                    }
                }

            </div>
        </div>
        <div class="muahang" style="display:none">
            <button type="submit" class="btn btn-primary" id="luulai">Yêu cầu Vật Tư cho các Lệnh SX đã chọn</button>
            <span id="fileinput" style="display:none">

            </span>

        </div>

    </div>
</div>

<script src="~/Scripts/jquery-1.9.1.min.js"></script>


<script>
    $(document).ready(function () {
        $(".abc").change(function () {
            GetValueModel();
        });
        $(".checkall").change(function () {

            if ($('.checkall:checked').val() !== undefined) {
                $('.abc').prop('checked', 'checked');
            }
            else {
                $('.abc').prop('checked', false);
            }
            GetValueModel();
        });
        function GetValueModel() {

            var names = $('.parent input:checked').map(function () { return this.name; }).get();
            $(".ketqua").text(names);
            $(".ketqua").val(names);
            if (names.length > 0) {
                $(".muahang").attr("style", "display:inherit");
                var arr = names;
                var i = 0; var e = 1;
                var oper = $("#oper").val();
                $('#fileinput').html('');
                $('#fileinput').html($('#fileinput').html() + '<input type="text" id="chuoi_' + 0 + '"  name="chuoi[' + 0 + ']" value="' + oper + '"/>');
                for (i = 0; i < names.length; i++) {
                    $('#fileinput').html($('#fileinput').html() + '<input type="text" id="chuoi_' + e + '"  name="chuoi[' + e + ']" value="' + arr[i] + '"/>');
                    e = e + 1;
                }
            }
            else {
                $(".muahang").attr("style", "display:none");
            }
        };
    });
</script>