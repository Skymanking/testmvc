@{
    ViewBag.Title = "View";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var detail = (Model.ERP.ePlaningDetail1)ViewBag.temp;
    var line = (string)ViewBag.line;
    decimal sumqty = 0;
    decimal sumallqty = 0;
    decimal rate = 0;

}

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title"> Thông Tin Chi Tiết Lệnh SX - Số: <strong>@detail.job.job</strong></h3>
    </div>
    <div class="card-body">
        @if (detail != null)
        {
            <div class="row">
                <div class="col-3">
                    <img class="img-fluid pad" src="~/Assets/theme3/dist/img/noimgpro.png" alt="link hình bị lỗi">

                </div>
                <div class="col-9">
                    <h3>@detail.job.description</h3>
                    <h5> Mã SP:<strong style="color:red;">@detail.job.item</strong> Số lượng:<strong style="color:red;">@detail.job.qty_released.ToString("N0")</strong></h5>
                    <h5>Thời gian:<strong style="color:red;">@detail.StartDate.Value.ToString("dd/MM/yyyy hh:mm") - @detail.EndDate.Value.ToString("dd/MM/yyyy hh:mm") </strong> </h5>
                    <h5>Line:<strong style="color:red;">@line</strong> </h5>
                   
                </div>

                <div class="col-md-12">
                    @foreach (var item1 in detail.dsOperation)
                    {
                        <div class="invoice p-3 mb-3">
                            <div class="row">
                                <div class="col-12">
                                    <h4><i class="fa fa-globe"></i> CÔNG ĐOẠN SỐ @item1.oper_num</h4>
                                </div>
                            </div>
                            <div class="row invoice-info">
                                <div class="col-sm-4 invoice-col">
                                    <address>
                                        <strong>CÔNG SUẤT</strong><br>
                                    </address>
                                </div>
                                <div class="col-sm-4 invoice-col">
                                    <address>
                                        <strong>SỐ LƯỢNG </strong><br>
                                        Tổng SP Đạt: @item1.qty_complete.Value.ToString("N0")<br>
                                        Tổng SP NG: @item1.qty_scrapped.Value.ToString("N0")<br>
                                    </address>
                                </div>
                                <div class="col-sm-4 invoice-col">
                                    <address>
                                        <strong>KHÁC</strong><br>
                                    </address>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>STT</th>
                                                <th>Mã vật tư</th>
                                                <th>Tên vật tư</th>
                                                <th>Số lượng</th>
                                                <th>Đơn vị tính</th>
                                                <th>Tỉ lệ %</th>
                                            </tr>
                                        </thead>
                                        @foreach (var item2 in detail.dsMaterial)
                                        {
                                            if (item2.oper_num == item1.oper_num && @item2.units =="U")
                                            { sumallqty = sumallqty + item2.matl_qty.Value * detail.job.qty_released; }
                                        }
                                        <tbody>
                                            @foreach (var item2 in detail.dsMaterial)
                                            {

                                                if (item2.oper_num == item1.oper_num)
                                                {
                                                    <tr>
                                                        <td>@item2.sequence </td>
                                                        <td>@item2.item</td>
                                                        <td>@item2.description</td>
                                                        <td>@{sumqty = item2.matl_qty.Value * detail.job.qty_released;} @sumqty.ToString("N3")</td>
                                                        <td>@item2.u_m</td>
                                                        <td>@{rate = @sumqty * 100 / @sumallqty;} @rate.ToString("N2") %</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>
        }
        else
        { <span>Lỗi</span>}
    </div>
</div>
