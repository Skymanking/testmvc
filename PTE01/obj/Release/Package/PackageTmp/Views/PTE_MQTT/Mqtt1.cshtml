@model List<Model.EFBIO.PTE_MQTT>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    string ngaythangnam = "INPUTDATA" + DateTime.Now.ToUniversalTime();
    var listIP = (List<Model.EFBIO.PTE_MQTT>)ViewBag.Linek;

}
@section jsFooter
{
    <script src="/Assets/plugin/ckfinder/ckfinder.js"></script>
    <script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
    <script src="/Assets/theme3/plugins/timepicker/bootstrap-timepicker.min.js"></script>
    <script>
        $(function () {
            $("#ngay1").datepicker();
            $("#ngay2").datepicker();
            $('input[type="checkbox"].flat-green, input[type="radio"].flat-green').iCheck({
                checkboxClass: 'icheckbox_flat-green',
                radioClass: 'iradio_flat-green'
            })
        })
    </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                    ['Time', 'Nhiet'],
                    ['00:00', 0],
                @foreach (var item in Model){
                    <text>
                    ['@Convert.ToString(item.Time.Hour):@Convert.ToString(item.Time.Minute)', @(Convert.ToInt32(item.Temp))],
                    </text>

                }
            ]);
            var options = {
                title: 'MQTT',
                curveType: 'function',
                legend: { position: 'bottom' }
            };
            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
            chart.draw(data, options);
        }
    </script>

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>


<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<div class="card card-primary">

    <div class="card-header">
        <h3 class="card-title">Tìm kiếm nâng cao</h3>
        <div class="card-tools">
            <div class="btn-group" style="height:37px">
                <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
                    More
                </button>
                <div class="dropdown-menu float-right" role="menu">
                    <a class="dropdown-item" href="/PTE_baocom/Report2" style="color:#000">Danh sách đặt cơm</a>
                    <a class="dropdown-item" href="/PTE_baocom/Index2" style="color:#000">Sửa</a>
                </div>
            </div>


        </div>

    </div>

    <div class="card-body">
        @using (Html.BeginForm("Report2", "PTE_baocom", FormMethod.Get))
        {
            <div class="row">
                <div class="col-md-2">
                    <label class="control-label">Dep</label><br>
                    <select class="form-control select2" id="may" name="may">
                        @foreach (var item in listIP)
                        {
                            if (ViewBag.dep == item.IP)
                            {
                                <option value="@item.IP" selected>@item.IP</option>
                            }
                            else
                            {
                                <option value="@item.IP">@item.IP</option>}

                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="control-label" style="color: #FF5722;">Ngày</label>
                    <div class="bootstrap-timepicker">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" id="ngay1" name="ngay1" class="form-control" value="@if(ViewBag.ngay1!=null){@ViewBag.ngay1}else{@DateTime.Now.ToShortDateString()}"><br>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="control-label" style="color: #FF5722;">Đến</label>
                    <div class="bootstrap-timepicker">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" id="ngay2" name="ngay2" class="form-control" value="@if(ViewBag.ngay2!=null){@ViewBag.ngay2}else{@DateTime.Now.ToShortDateString()}"><br>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="callout callout-info">
                        <label class="control-label" style="color: #FF5722;">Tìm kiếm</label><br>
                        <input type="text" class="form-control" id="searchString" name="searchString" placeholder="Tìm kiếm" />
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <label class="control-label"></label>
                    <div class="form-group">
                        <a class="btn btn-primary" id="inbaocao">Tìm kiếm</a>
                    </div>
                </div>
            </div>
        }
        <script src="~/Scripts/jquery-1.9.1.min.js"></script>
        <script>
            $(document).ready(function () {
                $("#inbaocao").click(function () {
                    var may = $("#may").val();
                    var ngay1 = $('#ngay1').val();
                    var ngay2 = $('#ngay2').val();
                    var searchString = $('#searchString').val();
                    $('#inbaocao').attr("href", '/PTE_MQTT/Mqtt1?may=' + may + '&ngay1=' + ngay1 + '&ngay2=' + ngay2 + '&searchString=' + searchString);
                });
            });

        </script>
    </div>
    <div class="card-footer">

    </div>

</div>
<div id="curve_chart" style="width: 1700px; height: 500px"></div>
<div class="row">
    <div class="col-md-12">
        <div class="card card-success card-outline">
            <div class="card-header">
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa fa-clipboard"></i> <span id="sokq" style="color:red;font-weight:bold;"></span> Kết quả</h3>
                            <div class="card-tools">
                                <div class="btn-group" style="height:40px">
                                    <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
                                        Tool
                                    </button>
                                    <div class="dropdown-menu float-right" role="menu">
                                        <span class="dropdown-item" onclick="exportTableToExcel('baocom', '@ngaythangnam')">Export to Excel</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script>
                            function exportTableToExcel(tableID, filename) {
                                var downloadLink;
                                var dataType = 'application/vnd.ms-excel';
                                var tableSelect = document.getElementById(tableID);
                                var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
                                filename = filename ? filename + '.xls' : 'excel_data.xls';
                                downloadLink = document.createElement("a");
                                document.body.appendChild(downloadLink);
                                if (navigator.msSaveOrOpenBlob) {
                                    var blob = new Blob(['\ufeff', tableHTML], {
                                        type: dataType
                                    });
                                    navigator.msSaveOrOpenBlob(blob, filename);
                                } else {
                                    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
                                    downloadLink.download = filename;
                                    downloadLink.click();
                                }
                            }
                        </script>
                        <table class="table table-striped table-bordered table-hover" id="MQTT1">
                            <thead>
                                <tr>
                                    <th>IP</th>
                                    <th>Thời gian</th>
                                    <th>Nhiệt độ</th>
                                    <th>Topic</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr id="row_@item.ID">
                                        <td>@item.IP</td>
                                        <td>@item.Time</td>
                                        <td>@item.Temp</td>
                                        <td>@item.Topic</td>
                                    </tr>


                                }
                            </tbody>
                        </table>

                    </div>
                </div>
                <div class="card-footer clearfix">

                </div>
                <!-- /.panel-body -->
            </div>

        </div>
    </div>
</div>
