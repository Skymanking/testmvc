@model List<Model.EF.Notes>

@{
    ViewBag.Title = "Notes";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var ListTag = (List<Model.EF.Tags>)ViewBag.ListTag;
    var ListUser = ViewBag.ListUser;

}
<style>
    .dropdown-toggle::after {
        content: none;
    }

    .dropdown-item:hover {
        background-color: bisque;
    }
</style>
@section jsFooter
{
    <script>
        $('.select2').select2()
    </script>
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/Notes.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<div class="card card-primary">
    <div class="row">
        <div class="col-md-2">
            <div style="background-color:white;  border-radius: 10px;">
                <div style="padding:10px;">
                    <a href="/Notes/Notes" class="nav-link btn-primary" style="border-radius:5px">
                        <i class="fa fa-2x fa-file-text-o"></i>
                        <label>Notes</label>
                    </a>
                    <hr>
                    <div style="background-color: @(ViewBag.Menu == "All" ? "#e9f1f5":"")">
                        <a href="/Notes/Notes?Menu=All" class="nav-link">
                            <i class="fa fa-2x fa-pencil-square-o"></i>
                            <label>All Notes</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Favourites" ? "#e9f1f5":"")">
                        <a href="/Notes/Notes?Menu=Favourites" class="nav-link">
                            <i class="fa fa-2x fa-star-o"></i>
                            <label>Favorites</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Trash" ? "#e9f1f5":"")">
                        <a href="/Notes/Notes?Menu=Trash" class="nav-link">
                            <i class="fa fa-2x fa-trash-o"></i>
                            <label>Trash</label>
                        </a>
                    </div>
                    <div style="background-color: @(ViewBag.Menu == "Share" ? "#e9f1f5":"")">
                        <a href="/Notes/Notes?Menu=Share" class="nav-link">
                            <i class="fa fa-2x fa-share-alt"></i>
                            <label>Share With Me</label>
                        </a>
                    </div>
                    <hr>
                    <label>Tags</label>
                    @foreach (var tag in ListTag)
                    {<div class="row">
                            <div onclick="Search('@tag.Name')" class="nav-link col-md-10" style="color:@tag.Color; font-weight: bolder; background-color: @(ViewBag.Tags != null && ViewBag.Tags.Contains(@tag.Name) ? "#e9f1f5":"")">
                                &nbsp;<i class="fa fa-modx"></i>
                                @tag.Name
                            </div>
                            @if (tag.UserName != "All")
                            {
                                <div class="col-md-2" data-toggle="modal" data-target="#EditTag" style="float:right;" id="@tag.ID" onclick="EditTag(@tag.ID)"><i class="fa fa-wrench"></i></div>
                            }
                        </div>
                    }
                    <button class="btn btn-block" data-toggle="modal" data-target="#CreateTag">
                        &nbsp;<span class="fa fa-plus" style="color:red"></span>
                        New Tag
                    </button>
                </div>
                <div style="height: 10%; padding: 10px;">
                    <center>
                        <button type="button" style="width: 100%; height: 30px; border-radius: 6px; background-color:blue; border: none; color: white;" data-toggle="modal" data-target="#CreateModal">+ Add New Notes</button>
                    </center>
                </div>
            </div>
        </div>
        <div class="col-md-10" style="background-color:white; border-radius: 10px;">
            <div class="card-header">
                <h3 class="card-title">Notes</h3>
                <div class="card-tools">
                    @using (Html.BeginForm("Notes", "Notes", FormMethod.Get))
                    {
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" placeholder="Search" name="SearchString" id="searchText" value="@ViewBag.SearchString">
                            <div class="input-group-append">
                                <input type="hidden" name="Tags" value="@ViewBag.Tags" id="searchTag" />
                                <input type="hidden" name="Menu" value="@ViewBag.Menu" id="searchMenu" />
                                <button type="submit" class="btn btn-primary" id="btnSearch"><i class="fa fa-search"></i></button>
                            </div>
                            <button type="button" data-toggle="modal" data-target="#CreateModal" style="float:right; color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                        </div>}
                </div>
            </div>
            <div class="row">
                @foreach (var item in Model)
                {
                    var color = "while";
                    if (!string.IsNullOrEmpty(item.Tags))
                    {
                        try
                        {
                            color = ListTag.Where(x => x.Name == item.Tags).FirstOrDefault().Color;
                        }
                        catch { }
                    }
                    <div class="col-md-4 col-lg-3 col-sm-6" style="background-color: white; padding: 10px; " id="Note_@item.ID">
                        <div style="height: 250px; padding: 10px; border-radius: 10px; box-shadow: 3px 3px #C0C0C0; background-color: @(color + "26") " id="card_@item.ID">
                            <div class="row">
                                <div class="col-12">
                                    <div style="float: left;">
                                        @if (!string.IsNullOrEmpty(item.User))
                                        {
                                            <img src="~/Assets/theme3/dist/img/logo.png" width="45px" height="45px" style="border-radius:50%;" />}
                                        else
                                        {
                                            <img src="@item.User" width="45px" height="45px" style="border-radius:50%;" />
                                        }
                                    </div>
                                    <div style="float: left;" data-toggle="modal" data-target="#EditModal" onclick="EditTask(@item.ID)">
                                        <label>&nbsp;@(item.CreateBy.Length >=30? item.CreateBy.Substring(0, 30) +"...":item.CreateBy)</label>
                                        <p style="max-width:10ch"><i>&nbsp;@item.EditDate.ToShortDateString()</i></p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-primary">
                                <label>@(item.Name.Length >=24? item.Name.Substring(0, 24) +"...":item.Name)</label><br />
                                <p>
                                    @(item.Description.Length >=60? item.Description.Substring(0, 60) +"...":item.Description)
                                </p>
                            </div>
                            <div class="row" style="bottom:5%;position:absolute; width:100%">
                                <div style="width:5%"></div>
                                <div style="width:15%">
                                    <a style="float:left; color:@color" class="dropdown-toggle" data-toggle="dropdown" id="tag_@item.ID"><i class="fa fa-bookmark "></i></a>
                                    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 38px, 0px); top: 0px; left: 0px; will-change: transform;">
                                        @foreach (var tag in ListTag)
                                        {
                                            <a class="dropdown-item" onclick="ChangeTag('@tag.Name', @item.ID, @tag.ID)">
                                                <i class="@(ViewBag.Tags != null && ViewBag.Tags.Contains(tag.Name)?"fa fa-circle":"fa fa-circle-o")" style="color:@tag.Color"></i>
                                                @tag.Name
                                            </a>
                                        }
                                    </div>
                                </div>
                                <div style="width:45%"></div>
                                <div style="width:10%">
                                    @if (ViewBag.Menu == "Trash")
                                    {
                                        <a style="float:right" onclick="Hidden(@item.ID,0)" id="hidden_@item.ID">
                                            <i class="fa fa-undo" style="color: cornflowerblue" o></i>
                                        </a>
                                    }
                                    else
                                    {
                                        <a style="float:right" onclick="Hidden(@item.ID,1)" id="hidden_@item.ID">
                                            <i class="fa fa-trash-o" style="color:red" o></i>
                                        </a>
                                    }
                                </div>
                                <div style="width:10%">
                                    @if (item.Favourites)
                                    {
                                        <a style="float: right" onclick="ChangeFavourites(@item.ID)" id="favourites_@item.ID"><i class="fa fa-star" style="color: #ffc30e"></i></a>
                                    }
                                    else
                                    {
                                        <a style="float: right" onclick="ChangeFavourites(@item.ID)" id="favourites_@item.ID"> <i class="fa fa-star-o" style="color: #ffeb3b"></i></a>
                                    }
                                </div>
                                <div style="width:15%"></div>
                            </div>

                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="CreateTagForm">
    <div class="modal fade" id="CreateTag" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Add Tag</h4>
                </div>
                @using (Html.BeginForm("AddTag", "Notes", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Name</label>
                                <input type="text" class="form-control" name="name" id="nametag" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Color</label>
                                <input type="color" name="color" id="color" class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="createTag" style="background: red; padding: 7px;  color: white;" type="submit">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="EditTagForm">
    <div class="modal fade" id="EditTag" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Edit Tag</h4>
                </div>
                @using (Html.BeginForm("EditTag", "Notes", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10">
                                <label class="control-label col-md-12">Name</label>
                                <input type="text" class="form-control" name="name" id="editnametag" />
                                <input type="hidden" class="form-control" name="id" id="editIDtag" />
                            </div>
                            <div class="col-md-2">
                                <label class="control-label col-md-12">Color</label>
                                <input type="color" name="color" id="editcolortag" class="form-control" style="height:40px" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="EditTag" class="btn btn-success" style=" padding: 7px;  color: white;" type="submit">Lưu</button>
                        <button id="HidTag" class="btn btn-danger" style="padding: 7px;  color: white;" type="button" onclick="HiddenTag()">Xoá</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="Create">
    <div class="modal fade" id="CreateModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Add Note</h4>
                </div>
                @using (Html.BeginForm("Create", "Notes", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-9">
                                <label class="control-label col-md-12">Title</label>
                                <input type="text" class="form-control" name="title" id="title" />
                            </div>
                            <div class="col-md-3">
                                <label class="control-label col-md-12">Tag</label>
                                <select id="newtag" class="form-control select2" data-placeholder="Tag" style="width: 100%;" name="tag">
                                    <option value="">Chọn Tag</option>
                                    @foreach (var tag in ListTag)
                                    {
                                        <option value="@tag.Name">@tag.Name</option>
                                    }
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="control-label col-md-12">User</label>
                                <select id="share" class="form-control select2" style="width:100%" multiple="multiple" data-placeholder="Share">
                                    @foreach (var user in ListUser)
                                    {
                                        <option value="@user.ID">@user.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="shareList" name="user" value="" />
                            </div>
                            <div class="col-md-12">
                                <label class="control-label col-md-12">Description</label>
                                <textarea class="form-control" name="desc" rows="4"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="createP" style="background: red; padding: 7px;  color: white;" type="submit" onclick="CheckCreate(1)">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div id="Edit">
    <div class="modal fade" id="EditModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Edit Note</h4>
                </div>
                @using (Html.BeginForm("Edit", "Notes", FormMethod.Post))
                {
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-9">
                                <label class="control-label col-md-12">Title</label>
                                <input type="text" class="form-control" name="title" id="edittitle" />
                            </div>

                            <div class="col-md-3">
                                <label class="control-label col-md-12">Tag</label>
                                <select id="edittag" class="form-control select2" data-placeholder="Tag" style="width: 100%;" name="tag">
                                    <option value="">Chọn Tag</option>
                                    @foreach (var tag in ListTag)
                                    {
                                        <option value="@tag.Name">@tag.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="editID" name="id" value="" />
                            </div>
                            <div class="col-md-12">
                                <label class="control-label">Share</label> &nbsp; &nbsp; <span id="oldshare" style="color:burlywood"></span>
                                <select class="form-control select2" name="share" multiple="multiple" style="width:100%" id="editshare" data-placeholder="Share">
                                    <option value="">Chọn User</option>
                                    @foreach (var user in ListUser)
                                    {
                                        <option value="@user.ID">@user.Name</option>
                                    }
                                </select>
                                <input type="hidden" id="editListshare" name="user" value="" />

                            </div>
                            <div class="col-md-12">
                                <label class="control-label col-md-12">Description</label>
                                <textarea class="form-control" name="desc" rows="4" id="editdes"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="editTask" style="background: red; padding: 7px;  color: white;" type="submit" onclick="CheckCreate(2)">Lưu thông tin</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

