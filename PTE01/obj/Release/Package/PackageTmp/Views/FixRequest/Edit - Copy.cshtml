@model Model.EF.FixRequest
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Theme1.cshtml";
    var userLogin = (string)ViewBag.userName;


    List<SelectListItem> loaiyc = new List<SelectListItem>();
    loaiyc.Add(new SelectListItem
         {
             Text = "Sửa Chữa",
             Value = "Sửa Chữa",
             Selected = true
         });

    loaiyc.Add(new SelectListItem
         {
             Text = "Cài đặt mới",
             Value = "Cài đặt mới",

         });
    loaiyc.Add(new SelectListItem
    {
        Text = "Nâng Cấp",
        Value = "Nâng Cấp",
    });

    loaiyc.Add(new SelectListItem
         {
             Text = "Bảo Trì",
             Value = "Bảo Trì",

         });
    List<SelectListItem> capdo = new List<SelectListItem>();
    capdo.Add(new SelectListItem
         {
             Text = "Bình Thường",
             Value = "Bình Thường",
             Selected = true
         });
    capdo.Add(new SelectListItem
         {
             Text = "Khẩn Cấp",
             Value = "Khẩn Cấp",

         });

    List<SelectListItem> nguoinhan = new List<SelectListItem>();
    nguoinhan.Add(new SelectListItem
         {
             Text = "Nguyễn Viết Lợi",
             Value = "loi.nguyen",
             Selected = true
         });
    nguoinhan.Add(new SelectListItem
    {
        Text = "Nguyễn Văn Song (Cơ Điện Xưởng 1)",
        Value = "song.nguyen",
    });
    nguoinhan.Add(new SelectListItem
         {
             Text = "Trần Thanh Trực(Cơ Điện Xưởng 2-3)",
             Value = "truc.tran",

         });
    nguoinhan.Add(new SelectListItem
    {
        Text = "Trần Hoàng Thắng (Công Nghệ Thông Tin)",
        Value = "it",

    });
}



<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Xem Yêu Cầu Sửa Chữa Thiết Bị</h1>
    </div>
</div>
<div class="row">
    @using (Html.BeginForm("Edit", "FixRequest", FormMethod.Post))
    {
        @Html.AntiForgeryToken()

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <!-- Cot ben trai -->
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Thông Tin Yêu Cầu Sửa Chữa Thiết Bị
                </div>
                <div class="panel-body">
                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-group">
                                <div class='col-md-4'>
                                    <label class="control-label">Số Phiếu</label>
                                    @Html.TextBoxFor(model => model.ID, new { @class = "form-control", @readonly = "true" })
                                    @Html.ValidationMessageFor(model => model.ID, "", new { @class = "text-danger" })
                                </div>
                                <div class='col-md-4'>
                                    <label class="control-label">Người Tạo</label>
                                    @Html.TextBoxFor(model => model.CreateBy, new { @class = "form-control", @readonly = "true" })
                                    @Html.ValidationMessageFor(model => model.CreateBy, "", new { @class = "text-danger" })
                                </div>
                                <div class='col-md-4'>
                                    <label class="control-label">Ngày Tạo</label>
                                    @Html.TextBoxFor(model => model.CreateDate, new { @class = "form-control", @readonly = "true" })
                                    @Html.ValidationMessageFor(model => model.CreateDate, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-md-8'>
                                    <label class="control-label">Tên Thiết Bị</label>
                                    @Html.TextBoxFor(model => model.DeviceName, new { @class = "form-control", @readonly = "true" })
                                    @Html.ValidationMessageFor(model => model.DeviceName, "", new { @class = "text-danger" })
                                </div>
                                <div class='col-md-4'>
                                    <label class="control-label">Mã Thiết Bị</label>
                                    @Html.TextBoxFor(model => model.DeviceCode, new { @class = "form-control", @readonly = "true" , @placeholder = "mã số thiết bị"})
                                    @Html.ValidationMessageFor(model => model.DeviceCode, "", new { @class = "text-danger" })
                                </div>

                            </div>
                            <div class="form-group">
                                <div class='col-md-12'>
                                    <label class="control-label">Tình Trạng Thiết Bị</label>
                                    @Html.TextAreaFor(model => model.DeviceStatus, new { @class = "form-control", @rows = "7", @readonly = "true" })
                                    @Html.ValidationMessageFor(model => model.DeviceStatus, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class='col-md-3'>
                                        <label class="control-label">CPK lúc chưa sửa:</label>
                                        @Html.TextBoxFor(model => model.CPK1, new { @class = "form-control", @type = "number", @readonly = "true" })
                                    </div>
                                    <div class='col-md-3'>
                                        <label class="control-label">PPK lúc chưa sửa:</label>
                                        @Html.TextBoxFor(model => model.PPK1, new { @class = "form-control", @type = "number", @readonly = "true" })
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class='col-md-4'>
                                    <label class="control-label">Người Nhận Yêu Cầu</label>
                                    @Html.DropDownListFor(model => model.Receiver, null, new { @class = "form-control"})
                                    @Html.ValidationMessageFor(model => model.Receiver, "", new { @class = "text-danger" })
                                </div>
                                <div class='col-md-4'>
                                    <label class="control-label">Loại Yêu Cầu</label>
                                    @Html.DropDownListFor(model => model.Type, loaiyc, new { @class = "form-control"})
                                    @Html.ValidationMessageFor(model => model.Type, "", new { @class = "text-danger" })
                                </div>
                                <div class='col-md-4'>
                                    <label class="control-label">Cấp Độ Yêu Cầu</label>
                                    @Html.DropDownListFor(model => model.EmergencyLevel, capdo, new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.EmergencyLevel, "", new { @class = "text-danger" })
                                </div>
                                <script>
                                    $("#Receiver option").attr("disabled", "true");
                                    $("#Type option").attr("disabled", "true");
                                    $("#EmergencyLevel option").attr("disabled", "true");
                                </script>
                            </div>
                            <div class="form-group">
                                <div class='col-md-4'>
                                    <label class="control-label">Người Sửa Chữa Thiết Bị Chính</label>
                                    @if (userLogin == Model.Receiver)
                                    {
                                        if (Model.Fixer == null)
                                        { @Html.DropDownListFor(model => model.Fixer, null, "Chưa chọn người", new { @class = "form-control" })}
                                        else
                                        { @Html.DropDownListFor(model => model.Fixer, null, new { @class = "form-control" })}
                                    }
                                    else
                                    {
                                       
                                        if (Model.Fixer == null)
                                        { @Html.DropDownListFor(model => model.Fixer, null, "Chưa chọn người", new { @class = "form-control" })}
                                        else
                                        { @Html.DropDownListFor(model => model.Fixer, null, new { @class = "form-control" })}
                                          <script>
                                            $("#Fixer option").attr("disabled", "true");
                                        </script>
                                    }
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-md-12'>
                                    <label class="control-label">Nguyên nhân và các khắc phục</label>
                                    @if (userLogin == Model.Receiver || userLogin == Model.Fixer)
                                    {
                                        @Html.TextAreaFor(model => model.HowToFix, new { @class = "form-control", @rows = "7", @placeholder = " - Nguyên nhân dẫn đến tình trạng trên? \n - (1) Tại sao vấn đề không được phát hiện trước đó? \n - (2) Tại sao vấn đề (1) không được phát hiện trước đó? \n - Đề xuất biện pháp khắc phục lỗi trên như thế nào?" })
                                    }
                                    else
                                    {
                                        @Html.TextAreaFor(model => model.HowToFix, new { @class = "form-control", @rows = "7", @readonly = "true", @placeholder = " - Nguyên nhân dẫn đến tình trạng trên? \n - (1) Tại sao vấn đề không được phát hiện trước đó? \n - (2) Tại sao vấn đề (1) không được phát hiện trước đó? \n - Đề xuất biện pháp khắc phục lỗi trên như thế nào?" })

                                    }
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-md-12'>
                                    <label class="control-label">Đánh giá sau khi sửa chữa</label>

                                        @Html.TextAreaFor(model => model.Comment, new { @class = "form-control", @rows = "7", @placeholder = " - Đánh giá nhân viên và thiết bị sau khi sửa chữa (do người yêu hoặc trưởng bộ phận của người yêu cầu ghi) \n Note: phần này bắt buộc mới nghiệm thu được" })

                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class='col-md-3'>
                                        <label class="control-label">CPK sau khi sửa:</label>
                                        @Html.TextBoxFor(model => model.CPK2, new { @class = "form-control", @type = "number"})
                                    </div>
                                    <div class='col-md-3'>
                                        <label class="control-label">PPK sau khi sửa:</label>
                                        @Html.TextBoxFor(model => model.PPK2, new { @class = "form-control", @type = "number"})
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>

        </div>
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="col-md-3">Trưởng bộ phận duyệt</th>
                    <th class="col-md-3">Sửa Xong</th>
                    <th class="col-md-3">BP YC Nghiệm Thu</th>

                </tr>
            </thead>
            <tbody>
                <tr id="row_0">
                    <td>@Html.CheckBoxFor(model => model.HODApproval, new { @style = "height:90px; width:90px;" })</td>
                    <td>@Html.CheckBoxFor(model => model.Completed, new { @style = "height:90px; width:90px;" })</td>
                    <td>@Html.CheckBoxFor(model => model.Finished, new { @style = "height:90px; width:90px;" })</td>
                </tr>
                <tr id="row_0">
                    <td>@if(@Model.HODDate != null)
                        {@Model.HODDate.Value.ToString("dd/MM/yyyy")}</td>
                    <td>@if (@Model.CompletedDate != null) 
                        {@Model.CompletedDate.Value.ToString("dd/MM/yyyy")}</td>
                    <td>@if (@Model.FinishedDate != null)
                        {@Model.FinishedDate.Value.ToString("dd/MM/yyyy")}</td>
                </tr>


            </tbody>
        </table>
        <!--------------------------fd-------End------------------------------------>
        <div class="form-group">
            <div class="col-md-4">
                <input type="submit" value="Lưu Lại" class="btn btn-primary" />
            </div>
        </div>

    }
</div>


