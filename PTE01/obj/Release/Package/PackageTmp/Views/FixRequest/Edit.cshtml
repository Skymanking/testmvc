@model Model.EF.FixRequest
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var userLogin = (string)ViewBag.userName;


    List<SelectListItem> loaiyc = new List<SelectListItem>();
    loaiyc.Add(new SelectListItem
         {
             Text = "Sửa Chữa",
             Value = "Sửa Chữa",
             Selected = true
         });

    loaiyc.Add(new SelectListItem
         {
             Text = "Cài đặt mới",
             Value = "Cài đặt mới",

         });
    loaiyc.Add(new SelectListItem
    {
        Text = "Nâng Cấp",
        Value = "Nâng Cấp",
    });

    loaiyc.Add(new SelectListItem
         {
             Text = "Bảo Trì",
             Value = "Bảo Trì",

         });
    List<SelectListItem> capdo = new List<SelectListItem>();
    capdo.Add(new SelectListItem
         {
             Text = "Bình Thường",
             Value = "Bình Thường",
             Selected = true
         });
    capdo.Add(new SelectListItem
         {
             Text = "Khẩn Cấp",
             Value = "Khẩn Cấp",

         });

    List<SelectListItem> nguoinhan = new List<SelectListItem>();
    nguoinhan.Add(new SelectListItem
         {
             Text = "Nguyễn Viết Lợi (TP Bảo trì)",
             Value = "loi.nguyen",
             Selected = true
         });
    nguoinhan.Add(new SelectListItem
    {
        Text = "Nguyễn Văn Lơn (Cơ Điện Xưởng 1)",
        Value = "lon.nguyen",
    });
    nguoinhan.Add(new SelectListItem
         {
             Text = "Ngô Trọng Thảo (Cơ Điện Xưởng 2-3)",
             Value = "thao.ngo",

         });
    nguoinhan.Add(new SelectListItem
    {
        Text = "Triệu Quang Ngọc (Công Nghệ Thông Tin)",
        Value = "it",

    });
}
@section jsFooter
{
<script src="/Scripts/CancelFixRequest.js"></script>
<script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
<script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
<script src="/Assets/plugin/ckfinder/ckfinder.js"></script>
    <script>
        $(function () {
            $('.form_datetime').datetimepicker({
                format: 'mm/dd/yyyy hh:ii',
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
            });
            $('.select2').select2()

        })
    </script>
    <script>
        $(document).ready(function () {
            $(window).keydown(function (event) {
                if (event.keyCode == 13) {
                    event.preventDefault();
                    return false;
                }
            });
            $('#hinh').attr('src', $('#Image').val());
        });
    </script>
<script>
    $('#btnSelectImage').on('click', function (e) {
        e.preventDefault();
        var finder = new CKFinder();
        finder.selectActionFunction = function (url) {
            $('#Image').val(url);

            $('#hinh').attr('src', $('#Image').val());
        };
        finder.popup();
    })

</script>

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Thông Tin Yêu Cầu Sửa Chữa</h3>
    </div>
    @using (Html.BeginForm("Edit", "FixRequest", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">          
   
            <div class="row">
                <div class='col-md-2'>
                    <label class="control-label">Số Phiếu</label>
                    @Html.TextBoxFor(model => model.ID, new { @class = "form-control", @readonly = "true" })
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Người Tạo</label>
                    @Html.TextBoxFor(model => model.CreateBy, new { @class = "form-control", @readonly = "true" })
                </div>
                <div class='col-md-4'>
                    <label class="control-label">Ngày Tạo</label>
                    @Html.TextBoxFor(model => model.CreateDate, new { @class = "form-control", @readonly = "true" })
                </div>
                <div class='col-md-2'>
                    <label class="control-label">CPK lúc chưa sửa:</label>
                    @Html.TextBoxFor(model => model.CPK1, new { @class = "form-control", @type = "number", @readonly = "true" })
                </div>
                <div class='col-md-2'>
                    <label class="control-label">PPK lúc chưa sửa:</label>
                    @Html.TextBoxFor(model => model.PPK1, new { @class = "form-control", @type = "number", @readonly = "true" })
                </div>
            </div>
            <div class="row">
                <div class='col-md-9'>
                    <label class="control-label">Tên Thiết Bị</label>
                    @Html.TextBoxFor(model => model.DeviceName, new { @class = "form-control", @readonly = "true" })
                </div>
                <div class="col-md-3">
                   
                        <label>Deadline:</label>

                        <div class="input-group date form_datetime" data-link-field="Deadline">
                            @if (Model.Deadline != null)
{<input class="form-control" type="text" value='@Model.Deadline.Value.ToString("MM/dd/yyyy HH:mm")' readonly style="background: #8BC34A;"> }
else
{ <input class="form-control" type="text" value='' readonly>}
                            
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                        @Html.TextBoxFor(model => model.Deadline, new { @class = "form-control", @type = "hidden" }) <br />
                </div>
                <div class="col-md-12">
                    <label class="control-label">Hình ảnh vấn đề</label>
                    <div class='input-group'>
                        @Html.TextBoxFor(model => model.Image, new { @class = "form-control", @style = "background: #f9d7d4;", @placeholder = "chọn hình" })
                        <div class=" input-group-append">
                            <span class="input-group-text">
                                <a id="btnSelectImage" href="#"><span class="fa fa-image"></span></a>
                            </span>

                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <img src="" id="hinh" class="img-thumbnail" style="width:100%">
                </div>
            </div>
            <div class="row">
                <div class='col-md-12'>
                    <label class="control-label">Tình Trạng Thiết Bị</label>
                    @Html.TextAreaFor(model => model.DeviceStatus, new { @class = "form-control", @rows = "7", @readonly = "true" })
                </div>
            </div>
            <div class="row">
                <div class='col-md-4'>
                    <label class="control-label">Người Nhận Yêu Cầu</label>
                    @Html.DropDownListFor(model => model.Receiver, null, new { @class = "form-control" })
                </div>
                <div class='col-md-4'>
                    <label class="control-label">Người Sửa Chữa</label>
                    @if (userLogin == Model.Receiver)
                    {
                        if (Model.Fixer == null)
                        { @Html.DropDownListFor(model => model.Fixer, null, "Chưa chọn người", new { @class = "form-control" })}
                        else
                        { @Html.DropDownListFor(model => model.Fixer, null, new { @class = "form-control" })}
                    }
                    else
                    {

                        if (Model.Fixer == null)
                        { @Html.DropDownListFor(model => model.Fixer, null, "Chưa chọn người", new { @class = "form-control" })}
                        else
                        { @Html.DropDownListFor(model => model.Fixer, null, new { @class = "form-control" })}
                                                                                                            <script>
                                                                                                                $("#Fixer option").attr("disabled", "true");
                                                                                                            </script>
                    }
                </div>

                <div class='col-md-2'>
                    <label class="control-label">Loại Yêu Cầu</label>
                    @Html.DropDownListFor(model => model.Type, loaiyc, new { @class = "form-control" })
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Cấp Độ Yêu Cầu</label>
                    @Html.DropDownListFor(model => model.EmergencyLevel, capdo, new { @class = "form-control" })
                </div>
                <script>
                    $("#Receiver option").attr("disabled", "true");
                    $("#Type option").attr("disabled", "true");
                    $("#EmergencyLevel option").attr("disabled", "true");
                </script>
            </div>


            <div class="row">
                <div class='col-md-12'>
                    <label class="control-label">Nguyên nhân và các khắc phục</label>
                    @if (userLogin == Model.Receiver || userLogin == Model.Fixer)
                    {
                        @Html.TextAreaFor(model => model.HowToFix, new { @class = "form-control", @rows = "7", @placeholder = " - Nguyên nhân dẫn đến tình trạng trên? \n - (1) Tại sao vấn đề không được phát hiện trước đó? \n - (2) Tại sao vấn đề (1) không được phát hiện trước đó? \n - Đề xuất biện pháp khắc phục lỗi trên như thế nào?" })
                    }
                    else
                    {
                        @Html.TextAreaFor(model => model.HowToFix, new { @class = "form-control", @rows = "7", @readonly = "true", @placeholder = " - Nguyên nhân dẫn đến tình trạng trên? \n - (1) Tại sao vấn đề không được phát hiện trước đó? \n - (2) Tại sao vấn đề (1) không được phát hiện trước đó? \n - Đề xuất biện pháp khắc phục lỗi trên như thế nào?" })

                    }
                </div>
            </div>

            <div class="row">
                <div class='col-md-12'>
                    <label class="control-label">Đánh giá sau khi sửa chữa</label>
                    @Html.TextAreaFor(model => model.Comment, new { @class = "form-control", @rows = "7", @placeholder = " - Đánh giá nhân viên và thiết bị sau khi sửa chữa (do người yêu cầu hoặc trưởng bộ phận của người yêu cầu ghi) \n Note: phần này bắt buộc mới nghiệm thu được" })
                </div>
            </div>
            <div class="row">
                    <div class='col-md-3'>
                        <label class="control-label">CPK sau khi sửa:</label>
                        @Html.TextBoxFor(model => model.CPK2, new { @class = "form-control", @type = "number" })
                    </div>
                    <div class='col-md-3'>
                        <label class="control-label">PPK sau khi sửa:</label>
                        @Html.TextBoxFor(model => model.PPK2, new { @class = "form-control", @type = "number" })
                    </div>
            </div>

         

            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th class="col-md-3" style="width:90px">Trưởng bộ phận duyệt</th>
                        <th class="col-md-3" style="width:90px">Sửa Xong</th>
                        <th class="col-md-3" style="width:90px">BP YC Nghiệm Thu</th>

                    </tr>
                </thead>
                <tbody>
                    <tr id="row_0">
                        <td>@Html.CheckBoxFor(model => model.HODApproval, new { @style = "height:90px; width:90px;" })</td>
                        <td>@Html.CheckBoxFor(model => model.Completed, new { @style = "height:90px; width:90px;" })</td>
                        <td>@Html.CheckBoxFor(model => model.Finished, new { @style = "height:90px; width:90px;" })</td>
                    </tr>
                    <tr id="row_0">
                        <td>
                            @if (@Model.HODDate != null)
                            {@Model.HODDate.Value.ToString("dd/MM/yyyy")}
                    </td>
                    <td>
                        @if (@Model.CompletedDate != null)
                        {@Model.CompletedDate.Value.ToString("dd/MM/yyyy")}
                </td>
                <td>
                    @if (@Model.FinishedDate != null)
                    {@Model.FinishedDate.Value.ToString("dd/MM/yyyy")}
            </td>
        </tr>


        </tbody>
        </table>

        </div>
        <div class="card-footer">
           
                <button type="submit" class="btn btn-primary">Lưu thông tin</button>
                <button type="button" class="btn btn-danger float-right" data-toggle="modal" data-target="#myModal">Xóa Phiếu Yêu Cầu </button>
        </div>
    }
</div>


    
     <form id="myForm" method="post">
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                Modal content
                <div class="modal-content">
                    <div class="modal-header">
                        <span class="float-left"><h4 class="modal-title">Lý do xóa phiếu</h4></span>
                        <span class="float-right"><button type="button" class="close" data-dismiss="modal" style="width:20px">&times;</button></span>
                    </div>
                    <div class="modal-body">
                        <input class="form-control" data-val="true" id="lydo" name="lydo" placeholder="điền lý do hủy phiếu " type="text" value="">
                    </div>
                    <script>
                        $(document).ready(function () {
                            $("#lydo").keypress(function () {
                                var lydos = $('#lydo').val();
                                var abc = $('#huyphieu').attr("data-lydo", lydos);
                            });
                        });
                    </script>

                    <div class="modal-footer">
                        <a href="#" id="huyphieu" class="btn-cancel" data-id="@Model.ID" style="background: red;    padding: 7px;  color: white;">Hủy Phiếu</a>
                    </div>
                </div>

            </div>
        </div>
    </form>