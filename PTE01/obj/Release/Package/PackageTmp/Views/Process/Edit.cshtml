@model Model.EF.FullProcess
@{
    ViewBag.Title = "CreateProcess";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    List<Model.EF.ProcessOperation> listoper = ViewBag.listoper;
    List<Model.View.TaskView1> listtask = ViewBag.listtask;
    var modelrequest = ViewBag.Req;
    string creater = ViewBag.creater;
    var uutien = new List<SelectListItem>();
    uutien.Add(new SelectListItem
    {
        Text = "Low",
        Value = "1",
        Selected = true
    });
    uutien.Add(new SelectListItem
    {
        Text = "Medium",
        Value = "2",
    });
    uutien.Add(new SelectListItem
    {
        Text = "High",
        Value = "3",
    });
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<script src="/Assets/theme3/plugins/timepicker/bootstrap-timepicker.min.js"></script>
<script>
    $(function () {
        $(".date").datepicker();
        $('.select2').select2()
    })
</script>


<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Request a Quotation</h3>
    </div>
    @using (Html.BeginForm("Edit", "Process", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">
            <div class="row">
                <div class="col-md-1">
                    <label class="control-label col-md-12">ID</label>
                    <input class="form-control" value="@Model.item.IDRequest" name="item.IDRequest" readonly />
                    <input hidden value="@Model.item.ID" name="item.ID" />
                </div>
                <div class="col-md-7">
                    <label class="control-label col-md-12">Name</label>
                    <input class="form-control" value="@modelrequest.Name" name="item.Name" required />
                </div>
                <div class='col-md-2'>
                    <label>Deadline:</label>
                    <div class="bootstrap-timepicker">
                        <div class="form-group" style="margin-bottom: 0;">
                            <div class="input-group">
                                <input type="text" id="item.Deadline" name="item.Deadline" class="date form-control" value='@Model.item.Deadline.Value.ToShortDateString()'><br>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Priority</label>
                    <select class="form-control" name="item.Priority">
                        @foreach (var item in uutien)
                        {
                            if (item.Value == Model.item.Priority.ToString())
                            {
                                <option value="@item.Value" selected>@item.Text</option>
                            }
                            else
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        }
                    </select>
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Customer ID</label>
                    <input class="form-control" value="@modelrequest.CustomerID" readonly />
                </div>
                <div class='col-md-3'>
                    <label class="control-label">Customer Name</label>
                    <input class="form-control" value="@modelrequest.CustomerName" readonly />
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Item ID</label>
                    <input class="form-control" value="@modelrequest.Item" readonly />
                </div>
                <div class='col-md-3'>
                    <label class="control-label">Item Name</label>
                    <input class="form-control" value="@modelrequest.ItemName" readonly />
                </div>
                <div class='col-md-2'>
                    <label class="control-label">Loại</label>
                    @if (modelrequest.Type == 0)
                    {
                        <input class="form-control" value="Sản phẩm mới" readonly />}
                    else if (modelrequest.Type == 1)
                    {
                        <input class="form-control" value="Cải tiến" readonly />
                    }
                    else
                    {
                        <input class="form-control" value="Sản xuất hàng loạt" readonly />
                    }
                </div>
                <div class="col-md-12">
                    <label class="control-label col-md-12">Note</label>
                    <textarea class="form-control" name="item.Note" id="item.Note">@Model.item.Note</textarea>
                </div>
            </div>
            <div class="rows">
                <div class="form-group" style="padding-top:20px;">
                    <table class="table table-striped table-bordered table-hover" id="gvCustomers">
                        <thead>
                            <tr>
                                <th>Operation</th>
                                <th style="width: 100px;">Quantity</th>
                                <th style="width: 160px;">Owner</th>
                                <th style="width: 160px;">Deadline</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < listoper.Count; i++)
                            {
                                var TaskView1 = new Model.View.TaskView1 { };
                                try
                                {
                                    TaskView1 = listtask.Where(x => x.ID == Model.detail[i].IDTask).FirstOrDefault();
                                }
                                catch { }
                                <tr>
                                    <td>
                                        <span style="font-size:20px; font-weight:bold;color:red;">@listoper[i].Name</span>
                                        <span style="display:none;">
                                            <input class="form-control" name="detail[@i].IDOperation" type="text" value="@listoper[i].ID">
                                            <input class="form-control" name="detail[@i].OperName" type="text" value="@listoper[i].Name">
                                            <input class="form-control" name="detail[@i].ID" type="text" value="@listoper[i].ID">
                                        </span>
                                    </td>
                                    @if (TaskView1 != null) 
                                    {
                                <td colspan="4" style="width:70%">
                                    @MyHelper.ViewTaskinTask(TaskView1, null)
                                </td>
                                    }
                                    else
                                    {
                                    <td>
                                        @*@Html.TextBoxFor(model => model.detail[i].Quantity, new { @class = "form-control", @type = "number", @style = "background:#f798c4" })*@
                                        <input class="form-control" id="Quantity_@i" name="detail[@i].Quantity" type="number" value="@Model.detail[i].Quantity">
                                    </td>
                                    <td>
                                        <select class="form-control" name="detail[@i].Owner">
                                            @if (listoper[i].Owner1 == Model.detail[i].Owner)
                                            {
                                                <option value="@listoper[i].Owner1" selected> @listoper[i].Owner1</option>
                                                <option value="@listoper[i].Owner2">@listoper[i].Owner2</option>
                                            }
                                            else
                                            {
                                                <option value="@listoper[i].Owner1"> @listoper[i].Owner1</option>
                                                <option value="@listoper[i].Owner2" selected>@listoper[i].Owner2</option>
                                            }

                                        </select>
                                    </td>
                                    <td>
                                        <div class="bootstrap-timepicker">
                                            <div class="form-group" style="margin-bottom: 0;">
                                                <div class="input-group">
                                                    <input type="text" id="end[@i]" name="detail[@i].Deadline" class="date form-control" value='@Model.detail[i].Deadline.ToShortDateString()'><br>
                                                    <div class="input-group-append">
                                                        <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td> <textarea class="form-control" name="detail[@i].Note">@Model.detail[i].Note</textarea></td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="row">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th class="col-md-6" style="width:20%;">R&D</th>
                                <th class="col-md-6" style="width: 20%;">Kế hoạch</th>
                                <th class="col-md-6" style="width: 20%;">Sản xuất</th>
                                <th class="col-md-6" style="width: 20%;">QC</th>
                                <th class="col-md-6" style="width: 20%;">BOD</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="background: #effde2;">@Html.CheckBoxFor(model => model.item.Approve1, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #d7f5ba;">@Html.CheckBoxFor(model => model.item.Approve2, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #bbed8b;">@Html.CheckBoxFor(model => model.item.Produced, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #a3ef5a;">@Html.CheckBoxFor(model => model.item.QC, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #86cd42;">@Html.CheckBoxFor(model => model.item.BOD, new { @style = "height:60px; width:60px;" })</td>
                            </tr>
                            <tr>
                                <td>
                                    @if (Model.item.ApproveDate1 != null)
                                    {<span> @Model.item.ApproveDate1.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.ApproveDate2 != null)
                                    {<span> @Model.item.ApproveDate2.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.ProducedDate != null)
                                    {<span> @Model.item.ProducedDate.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.QCDate != null)
                                    {<span> @Model.item.QCDate.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.BODDate != null)
                                    {<span> @Model.item.BODDate.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <script>
                        var allInputs = document.querySelectorAll('input[type="checkbox"]:checked');
                        for (var i = 0; i < allInputs.length; i++) {
                            allInputs[i].onclick = function () {
                                return false;
                            };
                        }
                    </script>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="row">
                <div class="col-6">
                    <button type="submit" class="nutsave btn btn-primary">Lưu thông tin</button>
                </div>

            </div>
        </div>
    }
</div>

