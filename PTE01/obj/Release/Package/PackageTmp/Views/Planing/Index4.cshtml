@model Model.View.LPlaningC

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var listLine = (List<Model.EF.WorkCenter>)ViewBag.Linek;
    var temp = (List<Model.View.PlaningView1>)ViewBag.temp;
}
@section jsFooter
{

    <script src="/Assets/theme3/plugins/timepicker/bootstrap-timepicker.min.js"></script>
    <script>
        $(function () {
            $("#start").datepicker();
            $("#end").datepicker();
            $("#StartDate").datepicker();
            $("#EndDate").datepicker();
            $('input[type="checkbox"].flat-green, input[type="radio"].flat-green').iCheck({
                checkboxClass: 'icheckbox_flat-green',
                radioClass: 'iradio_flat-green'
            })
            $('.select2').select2()
            $('.time1').timepicker({
                showInputs: false,
                showMeridian:false
            })
            $('.time2').timepicker({
                showInputs: false,
                showMeridian: false
            })
        })
    </script>
}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />
<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Kế Hoạch SX</h3>
        <div class="card-tools">
            <div class="btn-group" style="height:40px">
                <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
                    More
                </button>
                <div class="dropdown-menu float-right" role="menu">
                    <a class="dropdown-item" href="/Planing/Index4" style="color:#000">View Chart</a>
                    <a class="dropdown-item" href="/Planing/Index3" style="color:#000">View Detail</a>
                </div>
            </div>
        </div>

    </div>

    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <label class="control-label">Line</label><br>
                <select class="form-control select2" id="lines" name="lines">
                    <option value="">Hãy chọn Line</option>
                    @foreach (var item in listLine)
                    {
                        if (ViewBag.lines == item.ID)
                        {
                    <option value="@item.ID" selected>@item.Name</option>
                        }
                        else
                        {
                    <option value="@item.ID">@item.Name</option>}

                    }

                </select>
            </div>

            <div class="col-md-3">
                <label class="control-label">Từ:</label>
                <div class="bootstrap-timepicker">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="start" name="start" class="form-control" readonly="readonly" value='@if(ViewBag.start!=""){@ViewBag.start}else{@DateTime.Now.ToShortDateString()}'><br>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <label class="control-label">Đến:</label>
                <div class="bootstrap-timepicker">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="end" name="end" class="form-control" readonly="readonly" value='@if(ViewBag.end!=""){@ViewBag.end}else{@DateTime.Now.AddDays(7).ToShortDateString()}'><br>
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-3 text-center">
                <label class="control-label"></label>
                <div class="form-group">
                    <a class="btn btn-primary" id="inbaocao">Tìm kiếm</a>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function () {

                $("#inbaocao").click(function () {
                    var lines = $("#lines").val();
                    var start = $('#start').val();
                    var end = $('#end').val();
                    if(lines=="" || start=="" ||end=="")
                    {
                        alert("chưa nhập đủ thông tin");
                        $('#inbaocao').attr("href", '#');
                    }
                    else
                    { $('#inbaocao').attr("href", '/Planing/Index4?lines=' + lines+ '&start=' + start + '&end=' + end );}

                });
            });

        </script>
    </div>


</div>

<a href="/Planing/Create">Thêm kế hoạch mới<i class="fa fa-plus-circle" style="font-size: 20px; color: red"></i></a>

<div class="row">
    <div class="col-md-12">
        <div class="card card-success card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fa fa-clipboard"></i> <span id="sokq" style="color:red;font-weight:bold;"></span> Kết quả</h3>
            </div>
            <div class="card-body">
                <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

                <script type="text/javascript">
                    google.charts.load("current", { packages: ["timeline"] });
                    google.charts.setOnLoadCallback(drawChart);
                    function drawChart() {
                        var container = document.getElementById('example5');
                        var chart = new google.visualization.Timeline(container);
                        var dataTable = new google.visualization.DataTable();
                        dataTable.addColumn({ type: 'string', id: 'Role' });
                        dataTable.addColumn({ type: 'string', id: 'Name' });
                        dataTable.addColumn({ type: 'string', id: 'style', role: 'style' });
                        dataTable.addColumn({ type: 'string', role: 'tooltip' });
                        dataTable.addColumn({ type: 'date', id: 'Start' });
                        dataTable.addColumn({ type: 'date', id: 'End' });
                        dataTable.addRows([
                            @foreach(var item in temp)
                            {
                                if(item.SumOKQC*100 / item.Quantity<90)
                                {
                                  <text>
                                  ['@item.ItemID', '@(Math.Round(item.SumOKQC*100 / item.Quantity))% -@item.Quantity', 'fill-color: #ff0000;stroke-color: #ff0000;fill-opacity:0.4;', '<div style="font-size:14px;padding10px;"><b>Sản phẩm:</b> @item.ItemName <br/><b>SL Kế hoạch:</b>  @item.Quantity <br/><b>SL SX OK:@item.SumOKOUT</b> <br/><b>SL QC OK:@item.SumOKQC</b> <br/><b>Tổng số NG:@item.SumNG</b><br/><b>Từ:</b> @item.StartDate.ToString("dd/MM/yyyy HH:mm") <br/><b>Đến:</b>@item.EndDate.ToString("dd/MM/yyyy HH:mm")</div>', new Date(@item.StartDate.Year, @item.StartDate.Month, @item.StartDate.Day, @item.StartDate.Hour, @item.StartDate.Minute, 0), new Date(@item.EndDate.Year, @item.EndDate.Month, @item.EndDate.Day, @item.EndDate.Hour, @item.EndDate.Minute, 0)],
                                  </text>
                                  }
                                  else
                                {
                                     <text>
                                  ['@item.ItemID', '@(Math.Round(item.SumOKQC*100 / item.Quantity))% -@item.Quantity', 'fill-color: #28a745;stroke-color: #ff0000;fill-opacity:0.4;', '<div style="font-size:14px;padding10px;"><b>Sản phẩm:</b> @item.ItemName <br/><b>SL Kế hoạch:</b>  @item.Quantity <br/><b>SL SX OK:@item.SumOKOUT</b> <br/><b>SL QC OK:@item.SumOKQC</b> <br/><b>Tổng số NG:@item.SumNG</b><br/><b>Từ:</b> @item.StartDate.ToString("dd/MM/yyyy HH:mm") <br/><b>Đến:</b>@item.EndDate.ToString("dd/MM/yyyy HH:mm")</div>', new Date(@item.StartDate.Year, @item.StartDate.Month, @item.StartDate.Day, @item.StartDate.Hour, @item.StartDate.Minute, 0), new Date(@item.EndDate.Year, @item.EndDate.Month, @item.EndDate.Day, @item.EndDate.Hour, @item.EndDate.Minute, 0)],
                                  </text>
                                }
                            }
                        ]);
                        var options = { tooltip: { trigger: 'focus' } };
                        chart.draw(dataTable, options);
                    }
                </script>
                <div id="example5" style="height: 5350px;"></div>
            </div>
        </div>
    </div>
</div>

