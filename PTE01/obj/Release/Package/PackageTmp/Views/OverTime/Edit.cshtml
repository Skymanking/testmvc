@model Model.View.FullOverTime

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Theme3.cshtml";
    var lenght = Model.detail.Count();
    var listU = (IEnumerable<Model.View.UserView2>)ViewBag.listUser;
    TimeSpan sogio;
    var tem=0.01;
    int tongnguoi = 0;
    double tonggiotc = 0;
    var nguoinhan = new List<SelectListItem>();
    nguoinhan.Add(new SelectListItem
    {
        Text = "Chọn Người Tham Gia",
        Value = "none",
        Selected = true
    });
    foreach (var item in listU)
    {
        nguoinhan.Add(new SelectListItem
        {
            Text = item.FullName,
            Value = item.UserName,
        });
    }
}
@section jsFooter
{
<script src="/Scripts/CancelOverTime.js"></script>
<script src="/Scripts/AddUserOverTime.js"></script>
<script src="/Scripts/RemoveUserOverTime.js"></script>
    <script src="/Assets/theme3/plugins/timepicker/bootstrap-timepicker.min.js"></script>
@*<script src="/Assets/theme3/plugins/datepicker/js/bootstrap-datetimepicker.js"></script>
<script src="/Assets/theme3/plugins/datepicker/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>*@

    <script>
        $(function () {

            $('.select2').select2()
            $('.time1').timepicker({
                showInputs: false,
                showMeridian: false
            })
            $('.time2').timepicker({
                showInputs: false,
                showMeridian: false
            })
        })
    </script>
<script>
    $(document).ready(function () {
        $('#ngay1').text($(".date").val());
        $('#ngay2').text($(".date").val());       

    });
</script>

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
@*<link href="~/Assets/js/jquery-ui.css" rel="stylesheet" />*@
<script>
    $(function () {
        $(".date").datepicker();
    })
</script>

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">Thông tin đăng ký Tăng Ca (created by: @Model.item.CreateBy)</h3>
    </div>
    @using (Html.BeginForm("Edit", "OverTime", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card-body">
            <div class="row">
                <div style="display:none;">@Html.TextBoxFor(model => model.item.ID, new { @class = "form-control" })</div>
                <div class="col-md-9">
                    <label class="control-label col-md-12">Lý do tăng ca</label>
                    @Html.TextBoxFor(model => model.item.Reason, new { @class = "form-control" })
                </div>
                <div class="col-md-3">
                    <label>Ngày:</label>
                    <div class="input-group mb-3">
                        <input class="date form-control" type="text" id="item_TimeTo" name="item.TimeTo" value='@Model.item.TimeTo.ToString("MM/dd/yyyy")' disabled>
                        <div class=" input-group-append">
                            <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
       
                </div>
            </div>


            <div class="row" style="padding-top:20px;">
                <label class="form-control">
                    Danh sách nhân viên tăng ca:
                    <button type="button" data-toggle="modal" data-target="#myModaladdU" style="color: red; width: 30px; height: 30px; border-radius: 50%;"><span class="fa fa-plus"></span></button>
                </label>
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th style="width: 50px;">Xóa</th>
                            <th style="width: 70px;">Mã NV</th>
                            <th>Tên Nhân Viên</th>
                            <th style="width: 140px;">Từ</th>
                            <th style="width: 140px;">Đến</th>
                            <th style="width: 90px;">Số giờ TC</th>
                            <th>Ghi chú</th>

                        </tr>
                    </thead>
                    <tbody>
                         @for (var i = 0; i < Model.detail.Count; i++)
                         {
                             string nguoitemp = "";
                             {
                                 sogio = @Model.detail[i].Date2 - @Model.detail[i].Date1;
                                 tem = @sogio.Hours + (@Convert.ToDouble(sogio.Minutes) / 60);
                                 tongnguoi = tongnguoi + 1;
                                 tonggiotc = tonggiotc + tem;
                             }
                            
                             foreach (var item in nguoinhan)
                             {
                                 if (item.Value == Model.detail[@i].PerID)
                                 {
                                     nguoitemp = item.Text;
                                     break;
                                 }
                             }
                                <tr>
                                    <td><span class="input-group-text btn-removeU" data-id="@Model.item.ID" data-nguoimoi="@Model.detail[i].PerID" style="border-radius: 50%; border-width: 2px; border-style: outset;"><i class="fa fa-trash" style="color: #F44336;"></i></span></td>
                                    <td>@Model.detail[i].PerID</td>
                                    <td>@nguoitemp</td>
                                    <td>@Model.detail[i].Date1.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>@Model.detail[i].Date2.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>@String.Format("{0:0.0}", tem) giờ </td>
                                    <td>@Model.detail[i].Note</td>
                                </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="info-box">
                        <span class="info-box-icon bg-info"><i class="fa fa-group"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Tổng số Người tăng ca</span>
                            <span class="info-box-number">@tongnguoi</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-box">
                        <span class="info-box-icon bg-success"><i class="fa fa-clock-o" ></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Tổng số Giờ tăng ca</span>
                            <span class="info-box-number">@tonggiotc</span>
                        </div>
                    </div>
                </div>
            </div> 

            <div class="row">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th class="col-md-4" style="width:33%;">TBP duyệt</th>
                                <th class="col-md-4" style="width:33%;">HCNS duyệt</th>
                                <th class="col-md-4" style="width:33%;">BGD duyệt</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="row_0">
                                <td style="background: #f2fbe9;">@Html.CheckBoxFor(model => model.item.Approval1, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #d7f5ba;">@Html.CheckBoxFor(model => model.item.Approval2, new { @style = "height:60px; width:60px;" })</td>
                                <td style="background: #d7f5ba;">@Html.CheckBoxFor(model => model.item.Approval3, new { @style = "height:60px; width:60px;" })</td>
                            </tr>
                            <tr id="row_0">
                                <td>
                                    @if (Model.item.ApprovalDate1 != null)
                                    {<span> @Model.item.ApprovalName1 duyệt @Model.item.ApprovalDate1.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.ApprovalDate2 != null)
                                    {<span> @Model.item.ApprovalName2 duyệt @Model.item.ApprovalDate2.Value.ToString("dd/MM/yyyy")</span>}
                                </td>
                                <td>
                                    @if (Model.item.ApprovalDate3 != null)
                                    {<span> @Model.item.ApprovalName3 duyệt @Model.item.ApprovalDate3.Value.ToString("dd/MM/yyyy")</span>}
                                </td>

                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card-footer" >

            <button type="submit" class="btn btn-primary">Lưu thông tin</button>
            <button type="button" class="btn btn-danger float-right" data-toggle="modal" data-target="#myModalD">Xóa Phiếu Yêu Cầu </button>
        </div>

    }
</div>


<form id="myFormAddU" method="post">
    <div class="modal fade" id="myModaladdU" role="dialog">
        <div class="modal-dialog" style="max-width: 450px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm nhân viên</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class='col-md-12'>
                            <select class='form-control select2' id="nguoimoi" name="nguoimoi" style="width:100%">
                                @foreach (var item in nguoinhan)
                                {
                                    <option value="@item.Value">   @item.Text    </option>
                                }
                            </select>
                        </div>

                        <div class="col-md-6">
                            <div class="bootstrap-timepicker">
                                <div class="form-group">
                                    <label>Từ:<span id="ngay1"></span></label>
                                    <div class="input-group">
                                        <input autocomplete="off" class="time1 form-control" id="time1" name="time1" type="text" value="">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bootstrap-timepicker">
                                <div class="form-group">
                                    <label>Đến:<span id="ngay2"></span></label>
                                    <div class="input-group">
                                        <input autocomplete="off" class="time2 form-control" id="time2" name="time2" type="text" value="">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label class="control-label col-md-12">Ghi chú</label>
                            <textarea rows="3" class="form-control" id="note"></textarea>
                        </div>

                    </div>
                </div>
                <script>
                    $(document).ready(function () {

                        $("#createU").mouseenter(function () {
                            $('#createU').attr("data-nguoimoi", $('#nguoimoi').val());
                            $('#createU').attr("data-time1", $(".date").val() + " " + $('#time1').val());
                            $('#createU').attr("data-time2", $(".date").val() + " " + $('#time2').val());
                            $('#createU').attr("data-note", $('#note').val());
                        });
                        $('#time2').change(function () {
                            var d1 = $(".date").val() + " " + $("#time1").val();
                            var d2 = $(".date").val() + " " + $("#time2").val();
                            if (d1 > d2) {                                
                                $('#ngay2').text('hôm sau');
                            }
                            else {
                                $('#ngay2').text($(".date").val());
                            }
                        });
                        $('#time1').change(function () {
                            var d1 = $(".date").val() + " " + $("#time1").val();
                            var d2 = $(".date").val() + " " + $("#time2").val();
                            if (d1 > d2) {
                                $('#ngay2').text('hôm sau');
                            }
                            else {
                                $('#ngay2').text($(".date").val());
                            }
                        });

                    });
                </script>
                <div class="modal-footer">
                    <a href="#" id="createU" class="btn-createU" data-id="@Model.item.ID" style="background: red;    padding: 7px;  color: white;">Lưu thông tin</a>
                
                </div>
            </div>

        </div>
    </div>

</form>

<div id="myForm">
    <div class="modal fade" id="toolModal" role="dialog">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" style="width: 50px; font-size: 20px;">&times;</button>
                    <h4 class="modal-title" style="position: absolute;">Thêm Key milestone</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <label class="control-label col-md-12">Tên Key milestone</label>
                            <input type="text" class="form-control" id="keyname" />
                        </div>
                        <div class="col-md-6">
                            <label>Start Date:</label>
                            <div class="input-group mb-3">
                                <input class="date form-control" type="text" id="keystart" name="keystart">
                                <div class=" input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label>EndDate:</label>
                            <div class="input-group mb-3">
                                <input class="date form-control" type="text" id="keyend" name="keyend">
                                <div class=" input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" id="createP" class="btn-createP" data-id="@Model.item.ID" style="background: red; padding: 7px;  color: white;">Lưu thông tin</a>
                </div>
                <script>
                    $(document).ready(function () {
                        $("#createP").mouseenter(function () {
                            $('#createP').attr("data-keyname", $('#keyname').val());
                            $('#createP').attr("data-keystart", $('#keystart').val());
                            $('#createP').attr("data-keyend", $('#keyend').val());
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>


<form id="myFormD" method="post">
    <div class="modal fade" id="myModalD" role="dialog">
        <div class="modal-dialog">

            Modal content
            <div class="modal-content">
                <div class="modal-header">
                    <span class="float-left"><h4 class="modal-title">Lý do xóa phiếu</h4></span>
                    <span class="float-right"><button type="button" class="close" data-dismiss="modal" style="width:20px">&times;</button></span>
                </div>
                <div class="modal-body">
                    <input class="form-control" data-val="true" id="lydo" name="lydo" placeholder="điền lý do hủy phiếu " type="text" value="">
                </div>
                <script>
                    $(document).ready(function () {
                        $("#huyphieu").mouseenter(function () {
                            var lydos = $('#lydo').val();
                            var abc = $('#huyphieu').attr("data-lydo", lydos);

                        });
                    });
                </script>

                <div class="modal-footer">
                    <a href="#" id="huyphieu" class="btn-cancel" data-id="@Model.item.ID" style="background: red;    padding: 7px;  color: white;">Hủy Phiếu</a>
                </div>
            </div>

        </div>
    </div>
</form>
